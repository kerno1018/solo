define(["jquery","knockout","text!./widgetTemplate.html","modal-utils","./configWidgetViewModel","./aboutWidgetViewModel","acs-resource","alert-utils","acs-cache"],function(e,t,o,d,a,i,n,r,l){"use strict";function s(e){var o=this,d=e.data;o.fixed=e.fixed||!1,o.widget=t.observable(d),o.dashboardViewModel=e.parent,o.widgetContentTempate=t.observable(),o.widgetToolTipTemplate={name:window.__MODULE_PREFIX__("assets",w.WIDGET_TOOLTIP_TEMPLATE_URL)},d.viewModelPath=d.viewModelPath&&0!==d.viewModelPath.indexOf("modules/")?window.__MODULE_PREFIX__(d.module,d.viewModelPath):d.viewModelPath,d.templatePath=d.templatePath&&0!==d.templatePath.indexOf("modules/")?window.__MODULE_PREFIX__(d.module,d.templatePath):d.templatePath,d.viewModelPath?require([d.viewModelPath],function(e){var o="object"==typeof e?e:new e(d);d.widgetViewModel(o),d.onInitCallback&&"function"==typeof o[d.onInitCallback]&&(o[d.onInitCallback](),d.enableRefresh&&(d.refreshIntervalId=setInterval(o[d.onInitCallback],d.refreshInterval),l.setItem(w.STORAGE_PREFIX+d.id,d.refreshIntervalId))),t.applyBindingsToNode(document.getElementById(w.WIDGET_CONTENT_CONTAINER_ID+d.id),{template:{name:d.templatePath,data:o,afterRender:d.afterRender&&"function"==typeof o[d.afterRender]?o[d.afterRender]:null}}),d.afterRouting&&"function"==typeof o[d.afterRouting]&&o[d.afterRouting]()}):t.applyBindingsToNode(document.getElementById(w.WIDGET_CONTENT_CONTAINER_ID+d.id),{template:{name:d.templatePath}})}var w=function(e){return w=e,e.WIDGET_CONTENT_CONTAINER_ID="widgetContent-",e.WIDGET_TOOLTIP_TEMPLATE_URL="/js/lib/widget/widgetTooltipTemplate",e.CONFIG_WIDGET_TEMPLATE_URL="js/lib/widget/configWidgetTemplate",e.ABOUT_WIDGET_TEMPLATE_URL="js/lib/widget/aboutWidgetTemplate",e.DASHBOARD_CONTAINER_ID="#ss-container-dashboard-",e.STORAGE_PREFIX="widget",e.resource=new n({url:"dashboards"}),w}({});return s.prototype.removeWidget=function(){var o=this,d=o.dashboardViewModel,a=o.widget();e("#dropdown_"+a.id).dropdown("toggle");var i=d.selectedDashboard(),n=d.userDashboardData[i.id];t.utils.arrayForEach(n.widgets,function(e,t){e&&e.id===a.id&&n.widgets.splice(t,1)}),w.resource.update(n).done(function(){var t=d._filterDashboard(i.id,d.dashboards());a.refreshIntervalId&&clearInterval(a.refreshIntervalId),t.widgets.remove(a),e(w.DASHBOARD_CONTAINER_ID+i.id).trigger("removeWidget",a)}).fail(function(e,t,o){r.showErrorAlert(w.GENERIC_ERROR_MSG),console.log("Error occuured while removing widget from selected dashboard, Error - "+e.responseText)})},s.prototype.showAboutWidgetModal=function(){var t=this,o=t.dashboardViewModel,a=t.widget();e("#dropdown_"+a.id).dropdown("toggle"),d.showModal({template:window.__MODULE_PREFIX__("assets",w.ABOUT_WIDGET_TEMPLATE_URL),viewModel:new i(a,o),context:t})},s.prototype.showConfigWidgetModal=function(){var t=this,o=t.dashboardViewModel,i=t.widget();e("#dropdown_"+i.id).dropdown("toggle"),d.showModal({viewModel:new a(i,o),context:t,template:window.__MODULE_PREFIX__("assets",w.CONFIG_WIDGET_TEMPLATE_URL)}).then(t.configWidget)},s.prototype.configWidget=function(e){var o=this,d=o.dashboardViewModel,a=d.userDashboardData[d.selectedDashboard().id],i=o.widget();t.utils.arrayForEach(a.widgets,function(t){t.id===i.id&&(t.settings=e)}),w.resource.update(a).done(function(){i.settings=e,i.viewModelPath?require([i.viewModelPath],function(e){var o="object"==typeof e?e:new e(i);i.widgetViewModel(o),i.onInitCallback&&"function"==typeof o[i.onInitCallback]&&o[i.onInitCallback](),t.applyBindingsToNode(document.getElementById("widgetContent-"+i.id),{template:{name:i.templatePath,data:o,afterRender:i.afterRender&&"function"==typeof o[i.afterRender]?o[i.afterRender]:null}}),i.afterRouting&&"function"==typeof o[i.afterRouting]&&o[i.afterRouting]()}):t.applyBindingsToNode(document.getElementById(w.WIDGET_CONTENT_CONTAINER_ID+i.id),{template:{name:i.templatePath}})})},{viewModel:s,template:o}});