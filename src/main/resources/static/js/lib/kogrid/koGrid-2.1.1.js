define(["knockout"],function(e){!function(t){"use strict";t.kg||(t.kg={}),t.kg.numberOfGrids=0,t.kg.eventStorage={};var o="__kg_selected__",i=8,n=6,r="asc",a="desc",l="_kg_field_",s="_kg_depth_",c="_kg_hidden_",g="_kg_column_",d=/<.+>/;t.kg.moveSelectionHandler=function(e,o){if(t.kg.utils.isNullOrUndefined(e)||t.kg.utils.isNullOrUndefined(e.config.selectedItems))return!0;var n=o.which||o.keyCode,r=38===n?-1:40===n?1:null;if(!r)return!0;var a=e.renderedRows(),l=a.indexOf(e.selectionService.lastClickedRow)+r;return 0>l||l>=a.length?!0:(e.selectionService.ChangeSelection(a[l],o),l>a.length-i?e.$viewport.scrollTop(e.$viewport.scrollTop()+e.config.rowHeight*i):i>l&&e.$viewport.scrollTop(e.$viewport.scrollTop()-e.config.rowHeight*i),!1)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,o=Number(arguments[1])||0;for(o=0>o?Math.ceil(o):Math.floor(o),0>o&&(o+=t);t>o;o++)if(o in this&&this[o]===e)return o;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){var t=Object(this),o=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],n=arguments[1],r=0;o>r;r++)if(r in t){var a=t[r];e.call(n,a,r,t)&&i.push(a)}return i}),t.kg.utils={visualLength:function(e){var t=document.getElementById("testDataLength");return t||(t=document.createElement("SPAN"),t.id="testDataLength",t.style.visibility="hidden",document.body.appendChild(t)),$(t).css("font",$(e).css("font")),t.innerHTML=$(e).text(),t.offsetWidth},forIn:function(e,t){for(var o in e)e.hasOwnProperty(o)&&t(e[o],o)},evalProperty:function(t,o){var i=e.utils.unwrapObservable(t),n=o.split("."),r=0,a=e.utils.unwrapObservable(i[n[r]]),l=n.length;for(r++;a&&l>r;)a=e.utils.unwrapObservable(a[n[r]]),r++;return a},endsWith:function(e,t){return e&&t&&"string"==typeof e?-1!==e.indexOf(t,e.length-t.length):!1},isNullOrUndefined:function(e){return void 0===e||null===e?!0:!1},getElementsByClassName:function(e){for(var t=[],o=new RegExp("\\b"+e+"\\b"),i=document.getElementsByTagName("*"),n=0;n<i.length;n++){var r=i[n].className;o.test(r)&&t.push(i[n])}return t},getTemplatePromise:function(e){return $.ajax(e)},newId:function(){var e=(new Date).getTime();return function(){return e+=1}}(),ieVersion:function(){for(var e=3,t=document.createElement("div"),o=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",o[0];);return e>4?e:void 0}()},$.extend(t.kg.utils,{isIe6:function(){return 6===t.kg.utils.ieVersion}(),isIe7:function(){return 7===t.kg.utils.ieVersion}(),isIe:function(){return void 0!==t.kg.utils.ieVersion}()}),t.kg.defaultGridTemplate=function(){return'<div><div class="kgToolbar" style="position:relative" data-bind="visible: showToolbar"><div class="kgToolbarWrapper" data-bind="css: {kgRightMargin: $data.showColumnMenu}"><table style="width:100%"><tr><td data-bind="kgToolbarLeft: $data"></td><td style="text-align:right" data-bind="kgToolbarRight: $data"></td></tr></table></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><ul class="kgColList" data-bind="foreach: nonAggColumns"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"><span data-bind="text: displayName, click: toggleVisible">?</span></label></li></ul></div></div></div><div style="border: 1px solid rgb(212,212,212);border-bottom:0" data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ></div></div></div><div style="width:100%;height:24px" class="kgHeaderContainer kgFilter" data-bind="visible: showFilter"><div data-bind="foreach: visibleColumns"><div data-bind="attr: { \'class\': \'kgHeaderCell col\' + $index() }" style="text-align:center;"><input type="text" style="margin-top:3px;width:94%;height:18px;border: 1px solid rgb(204, 204, 204);font-size:12px;line-height:18px" data-bind="visible: showFilterBox, value: filterText, valueUpdate: \'afterkeydown\'"></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div></div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgFooterWraper"><table style="width:100%"><tr><td style="width:25%"><div data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Records: <span data-bind="text: origData().length"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div></div></td><td style="width:50%"><div class="kgPagerContainer" style="text-align:center" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><ul class="pagination ko-pagination-margin"><li data-bind="css: { disabled: cantPageBackward() }"><a href="#" data-bind="click: pageToFirst">&laquo;</a></li><!-- ko foreach: pageRange() --><li data-bind="css: { active: $data == $root.pagingOptions.currentPage() }"><a href="#" data-bind="text: $data, click: function() { $root.pagingOptions.currentPage($data) }"></a></li><!-- /ko --><li data-bind="css: { disabled: cantPageForward() }"><a href="#" data-bind="click: pageToLast">&raquo;</a></li></ul></div></td><td style="width:25%;text-align:right" class="form-inline"><label style="text-align:left" data-bind="visible: enablePaging"><select class="form-control input-sm" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select> per page</label></td></tr></table></div></div>'},t.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"></div></div>"},t.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index(), 'title': $data.getProperty($parent)}, html: $data.getProperty($parent)\"></div>"},t.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"></span> Items)</span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'},t.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"},t.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ></div></div>"},e.bindingHandlers.koGrid=function(){return{init:function(o,i,n,r,a){var l=i(),s=$(o);l.gridDim=new t.kg.Dimension({outerHeight:e.observable(s.height()),outerWidth:e.observable(s.width())});var c=new t.kg.Grid(l),g=$(t.kg.defaultGridTemplate());return c.config.data.subscribe(function(){c.$$selectionPhase||(c.searchProvider.evalFilter(),c.refreshDomSizes())}),e.isObservable(l.columnDefs)&&l.columnDefs.subscribe(function(e){c.columns([]),c.config.columnDefs=e,c.buildColumns(),c.configureColumnWidths()}),s.addClass("koGrid").addClass(c.gridId.toString()),s.append(g),c.$userViewModel=a.$data,e.applyBindings(c,g[0]),t.kg.domUtilityService.AssignGridContainers(s,c),c.configureColumnWidths(),c.refreshDomSizes(),c.eventProvider=new t.kg.EventProvider(c),$.each(c.config.plugins,function(e,t){"function"==typeof t.onGridInit&&t.onGridInit(c)}),t.kg.domUtilityService.BuildStyles(c),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgRow=function(){return{init:function(o,i,n,r,a){var l,s=i(),c=s.$grid=a.$parent;l=s.isAggRow?t.kg.aggregateTemplate():c.rowTemplate;var g=function(t){var i=$(t);s.$userViewModel=a.$parent.$userViewModel,e.applyBindings(s,i[0]),$(o).html(i)};return l.then?l.then(function(e){g(e)}):g(l),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgCell=function(){return{init:function(t,o,i,n,r){r.$userViewModel=r.$parent.$userViewModel;var a=function(o){var i=$(o);e.applyBindings(r,i[0]),$(t).html(i)};return n.cellTemplate.then?n.cellTemplate.then(function(e){a(e)}):a(n.cellTemplate),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgHeaderRow=function(){return{init:function(t,o,i,n,r){r.$userViewModel=r.$data.$userViewModel;var a=function(o){var i=$(o);e.applyBindings(r,i[0]),$(t).html(i)};return n.headerRowTemplate.then?n.headerRowTemplate.then(function(e){a(e)}):a(n.headerRowTemplate),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgHeaderCell=function(){return{init:function(t,o,i,n,r){var a=r.extend({$grid:r.$parent,$userViewModel:r.$parent.$userViewModel}),l=function(o){var i=$(o);e.applyBindings(a,i[0]),$(t).html(i)};return n.headerCellTemplate.then?n.headerCellTemplate.then(function(e){l(e)}):l(n.headerCellTemplate),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgToolbarLeft=function(){return{init:function(t,o,i,n,r){var a=function(o){for(var i=$(o),r=0;r<i.length;r++)e.applyBindings(n.$userViewModel,i[r]);$(t).html(i)};return n.leftToolbarTemplate&&a(n.leftToolbarTemplate),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.kgToolbarRight=function(){return{init:function(t,o,i,n,r){var a=function(o){for(var i=$(o),r=0;r<i.length;r++)e.applyBindings(n.$userViewModel,i[r]);$(t).html(i)};return n.rightToolbarTemplate&&a(n.rightToolbarTemplate),{controlsDescendantBindings:!0}}}}(),e.bindingHandlers.mouseEvents=function(){return{init:function(e,t,o,i,n){var r=t();r.mouseDown&&$(e).mousedown(r.mouseDown)}}}(),t.kg.Aggregate=function(t,o){var i=this;i.index=0,i.offsetTop=e.observable(0),i.entity=t,i.label=e.observable(t.gLabel),i.field=t.gField,i.depth=t.gDepth,i.parent=t.parent,i.children=t.children,i.aggChildren=t.aggChildren,i.aggIndex=t.aggIndex,i.collapsed=e.observable(!0),i.isAggRow=!0,i.offsetLeft=e.observable((25*t.gDepth).toString()+"px"),i.aggLabelFilter=t.aggLabelFilter,i.toggleExpand=function(){var e=i.collapsed();i.collapsed(!e),i.notifyChildren()},i.setExpand=function(e){i.collapsed(e),i.notifyChildren()},i.notifyChildren=function(){$.each(i.aggChildren,function(e,t){if(t.entity[c]=i.collapsed(),i.collapsed()){var o=i.collapsed();t.setExpand(o)}}),$.each(i.children,function(e,t){t[c]=i.collapsed()}),o.rowCache=[];var e=!1;$.each(o.aggCache,function(t,o){if(e){var n=30*i.children.length,r=i.collapsed();o.offsetTop(r?o.offsetTop()-n:o.offsetTop()+n)}else t==i.aggIndex&&(e=!0)}),o.renderedChange()},i.aggClass=e.computed(function(){return i.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"}),i.totalChildren=e.computed(function(){if(i.aggChildren.length>0){var e=0,t=function(o){o.aggChildren.length>0?$.each(o.aggChildren,function(e,o){t(o)}):e+=o.children.length};return t(i),e}return i.children.length}),i.selected=e.observable(!1),i.isEven=e.observable(!1),i.isOdd=e.observable(!1),i.toggleSelected=function(){return!0}},t.kg.Column=function(o,i){var n=this,l=o.colDef,s=500,c=0,g=null;n.eventTaget=void 0,n.width=l.width,n.groupIndex=e.observable(0),n.isGroupedBy=e.observable(!1),n.groupedByClass=e.computed(function(){return n.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"}),n.sortable=e.observable(!1),n.resizable=e.observable(!1),n.minWidth=l.minWidth?l.minWidth:50,n.maxWidth=l.maxWidth?l.maxWidth:9e3,n.headerRowHeight=o.headerRowHeight,n.displayName=e.observable(l.displayName||l.field),n.index=o.index,n.isAggCol=o.isAggCol,n.cellClass=e.observable(l.cellClass||""),n.cellFilter=l.cellFilter||l.cellFormatter,n.field=l.field,n.filterText=e.observable(),n.filterText.subscribe(function(e){var t="";$.each(i.visibleColumns(),function(e,o){var i=o.filterText();i&&(t+=o.displayName()+":"+i+";")}),i.config.filterOptions.filterText(t)}),n.aggLabelFilter=l.cellFilter||l.cellFormatter||l.aggLabelFilter||l.aggLabelFormatter,n._visible=e.observable(t.kg.utils.isNullOrUndefined(l.visible)||l.visible),n.visible=e.computed({read:function(){return n._visible()},write:function(e){n.toggleVisible(e)}}),o.enableSort&&n.sortable(t.kg.utils.isNullOrUndefined(l.sortable)||l.sortable),o.enableResize&&n.resizable(t.kg.utils.isNullOrUndefined(l.resizable)||l.resizable),n.sortDirection=e.observable(void 0),n.sortingAlgorithm=l.sortFn,n.headerClass=e.observable(l.headerClass),n.headerCellTemplate=l.headerCellTemplate||t.kg.defaultHeaderCellTemplate(),n.cellTemplate=l.cellTemplate||t.kg.defaultCellTemplate(),l.cellTemplate&&!d.test(l.cellTemplate)&&(n.cellTemplate=t.kg.utils.getTemplatePromise(l.cellTemplate)),l.headerCellTemplate&&!d.test(l.headerCellTemplate)&&(n.headerCellTemplate=t.kg.utils.getTemplatePromise(l.headerCellTemplate)),n.getProperty=function(e){var t;return t=n.cellFilter?n.cellFilter(e.getProperty(n.field)):e.getProperty(n.field)},n.toggleVisible=function(e){var o;o=t.kg.utils.isNullOrUndefined(e)||"object"==typeof e?!n._visible():e,n._visible(o),t.kg.domUtilityService.BuildStyles(i)},n.showSortButtonUp=e.computed(function(){return n.sortable?n.sortDirection()===a:n.sortable}),n.showSortButtonDown=e.computed(function(){return n.sortable?n.sortDirection()===r:n.sortable}),n.showFilterBox=l.showFilterBox!==!1&&"✔"!=l.field,n.noSortVisible=e.computed(function(){return!n.sortDirection()}),n.sort=function(){if(!n.sortable())return!0;var e=n.sortDirection()===r?a:r;return n.sortDirection(e),o.sortCallback(n,e),!1},n.gripClick=function(e,t){t.stopPropagation(),c++,1===c?g=setTimeout(function(){c=0},s):(clearTimeout(g),o.resizeOnDataCallback(n),c=0)},n.gripOnMouseDown=function(e){return e.stopPropagation(),e.ctrlKey?(n.toggleVisible(),t.kg.domUtilityService.BuildStyles(i),i.config.columnsChanged(i.columns.peek()),!0):(n.eventTaget=e.target.parentElement,n.eventTaget.style.cursor="col-resize",n.startMousePosition=e.clientX,n.origWidth=n.width,$(document).mousemove(n.onMouseMove),$(document).mouseup(n.gripOnMouseUp),!1)},n.onMouseMove=function(e){e.stopPropagation();var o=e.clientX-n.startMousePosition,r=o+n.origWidth;return n.width=r<n.minWidth?n.minWidth:r>n.maxWidth?n.maxWidth:r,t.kg.domUtilityService.BuildStyles(i),!1},n.gripOnMouseUp=function(e){return e.stopPropagation(),$(document).off("mousemove"),$(document).off("mouseup"),n.eventTaget.style.cursor=n.sortable()?"pointer":"default",n.eventTaget=void 0,i.config.columnsChanged(i.columns.peek()),!1}},t.kg.Dimension=function(e){this.outerHeight=null,this.outerWidth=null,$.extend(this,e)},t.kg.EventProvider=function(o){var i=this;i.colToMove=void 0,i.groupToMove=void 0,i.assignEvents=function(){o.config.jqueryUIDraggable?(o.$groupPanel.droppable({addClasses:!1,drop:function(e){i.onGroupDrop(e)}}),$(document).ready(i.setDraggables)):(o.$groupPanel.on("mousedown",i.onGroupMouseDown).on("dragover",i.dragOver).on("drop",i.onGroupDrop),o.$headerScroller.on("mousedown",i.onHeaderMouseDown).on("dragstart",i.dragStart).on("dragover",i.dragOver).on("drop",i.onHeaderDrop),o.config.enableRowReordering&&o.$viewport.on("mousedown",i.onRowMouseDown).on("dragover",i.dragOver).on("drop",i.onRowDrop),i.setDraggables()),o.columns.subscribe(i.setDraggables)},i.dragOver=function(e){e.preventDefault()},i.dragStart=function(e){e.originalEvent.dataTransfer.setData("text/plain","")},i.setDraggables=function(){o.config.jqueryUIDraggable?o.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:!1,start:function(e){i.onHeaderMouseDown(e)}}).droppable({drop:function(e){i.onHeaderDrop(e)}}):o.$root.find(".kgHeaderSortColumn").attr("draggable","true")},i.onGroupMouseDown=function(t){var n=$(t.target);if("kgRemoveGroup"!=n[0].className){var r=e.dataFor(n[0]);r&&(o.config.jqueryUIDraggable||n.attr("draggable","true"),i.groupToMove={header:n,groupName:r,index:r.groupIndex()-1})}else i.groupToMove=void 0},i.onGroupDrop=function(t){var n,r;i.groupToMove?(n=$(t.target).closest(".kgGroupElement"),"kgGroupPanel"==n.context.className?(o.configGroups.splice(i.groupToMove.index,1),o.configGroups.push(i.groupToMove.groupName)):(r=e.dataFor(n[0]),r&&i.groupToMove.index!=r.groupIndex()&&(o.configGroups.splice(i.groupToMove.index,1),o.configGroups.splice(r.groupIndex(),0,i.groupToMove.groupName))),i.groupToMove=void 0,o.fixGroupIndexes()):(-1==o.configGroups.indexOf(i.colToMove.col)&&(n=$(t.target).closest(".kgGroupElement"),"kgGroupPanel"==n.context.className||"kgGroupPanelDescription"==n.context.className?o.groupBy(i.colToMove.col):(r=e.dataFor(n[0]),r&&o.removeGroup(r.groupIndex()))),i.colToMove=void 0)},i.onHeaderMouseDown=function(t){var o=$(t.target).closest(".kgHeaderSortColumn");if(!o[0])return!0;var n=e.dataFor(o[0]);return n&&(i.colToMove={header:o,col:n}),!0},i.onHeaderDrop=function(n){if(!i.colToMove)return!0;var r=$(n.target).closest(".kgHeaderSortColumn");if(!r[0])return!0;var a=e.dataFor(r[0]);if(a){if(i.colToMove.col==a)return!0;var l=o.columns.peek();l.splice(i.colToMove.col.index,1),l.splice(a.index,0,i.colToMove.col),o.fixColumnIndexes(),o.columns(l),t.kg.domUtilityService.BuildStyles(o),i.colToMove=void 0}return!0},i.onRowMouseDown=function(o){var i=$(o.target).closest(".kgRow");if(i[0]){var n=e.dataFor(i[0]);n&&(i.attr("draggable","true"),t.kg.eventStorage.rowToMove={targetRow:i,scope:n})}},i.onRowDrop=function(i){var n=$(i.target).closest(".kgRow"),r=e.dataFor(n[0]);if(r){var a=t.kg.eventStorage.rowToMove;if(a.scope==r)return;var l=o.sortedData(),s=l.indexOf(a.scope.entity),c=l.indexOf(r.entity);o.sortedData.splice(s,1),o.sortedData.splice(c,0,a.scope.entity),o.searchProvider.evalFilter(),t.kg.eventStorage.rowToMove=void 0}},i.assignGridEventHandlers=function(){o.$viewport.scroll(function(e){var t=e.target.scrollLeft,i=e.target.scrollTop;o.adjustScrollLeft(t),o.adjustScrollTop(i)}),o.$viewport.off("keydown"),o.$viewport.on("keydown",function(e){return t.kg.moveSelectionHandler(o,e)}),-1===o.config.tabIndex?(o.$viewport.attr("tabIndex",t.kg.numberOfGrids),t.kg.numberOfGrids++):o.$viewport.attr("tabIndex",o.config.tabIndex),$(t).resize(function(){t.kg.domUtilityService.UpdateGridLayout(o),o.config.maintainColumnRatios&&o.configureColumnWidths()})},i.assignGridEventHandlers(),i.assignEvents()},t.kg.RowFactory=function(e){var n=this;n.rowCache=[],n.aggCache={},n.parentCache=[],n.dataChanged=!0,n.parsedData=[],n.rowConfig={},n.selectionService=e.selectionService,n.rowHeight=30,n.numberOfAggregates=0,n.groupedData=void 0,n.rowHeight=e.config.rowHeight,n.rowConfig={canSelectRows:e.config.canSelectRows,rowClasses:e.config.rowClasses,selectedItems:e.config.selectedItems,selectWithCheckboxOnly:e.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:e.config.beforeSelectionChange,afterSelectionChangeCallback:e.config.afterSelectionChange},n.renderedRange=e.fixedViewPortHeight?new t.kg.Range(0,e.minRowsToRender()+i):e.enablePaging?new t.kg.Range(0,e.pagingOptions.pageSize):new t.kg.Range(0,1e5),n.changeRenderedRangeWithPageSize=function(e){n.renderedRange=new t.kg.Range(0,e)},n.buildEntityRow=function(e,i){var r=n.rowCache[i];return r||(r=new t.kg.Row(e,n.rowConfig,n.selectionService),r.rowIndex(i+1),r.offsetTop((n.rowHeight*i).toString()+"px"),r.selected(e[o]),n.rowCache[i]=r),r},n.buildAggregateRow=function(e,o){var i=n.aggCache[e.aggIndex];return i||(i=new t.kg.Aggregate(e,n),n.aggCache[e.aggIndex]=i),i.index=o+1,i.offsetTop((n.rowHeight*o).toString()+"px"),i},n.UpdateViewableRange=function(e){n.renderedRange=e,n.renderedChange()},n.filteredDataChanged=function(){e.lateBoundColumns&&e.filteredData().length>1&&(e.config.columnDefs=void 0,e.buildColumns(),e.lateBoundColumns=!1),n.dataChanged=!0,n.rowCache=[],e.config.groups.length>0&&n.getGrouping(e.config.groups),n.UpdateViewableRange(n.renderedRange)},n.renderedChange=function(){if(!n.groupedData||e.config.groups.length<1)return n.renderedChangeNoGroups(),void e.refreshDomSizes();n.parentCache=[];var t=[],o=n.parsedData.filter(function(e){return e[c]===!1}).slice(n.renderedRange.topRow,n.renderedRange.bottomRow);$.each(o,function(e,o){var i;i=o.isAggRow?n.buildAggregateRow(o,n.renderedRange.topRow+e):n.buildEntityRow(o,n.renderedRange.topRow+e),t.push(i)}),e.setRenderedRows(t),e.refreshDomSizes()},n.renderedChangeNoGroups=function(){var t=[],o=e.config.enablePaging?e.sliceCurrentPageData(e.filteredData).slice(n.renderedRange.topRow,n.renderedRange.calcMaxCanvasHeight):e.filteredData.slice(n.renderedRange.topRow,n.renderedRange.bottomRow);$.each(o,function(e,o){var i=n.buildEntityRow(o,n.renderedRange.topRow+e);t.push(i)}),e.setRenderedRows(t)},n.parseGroupData=function(e){if(e.values)$.each(e.values,function(e,t){n.parentCache[n.parentCache.length-1].children.push(t),n.parsedData.push(t)});else for(var t in e)if(t!=l&&t!=s&&t!=g&&e.hasOwnProperty(t)){var o=n.buildAggregateRow({gField:e[l],gLabel:t,gDepth:e[s],isAggRow:!0,_kg_hidden_:!1,children:[],aggChildren:[],aggIndex:n.numberOfAggregates,aggLabelFilter:e[g].aggLabelFilter},0);n.numberOfAggregates++,o.parent=n.parentCache[o.depth-1],o.parent&&(o.parent.collapsed(!1),o.parent.aggChildren.push(o)),n.parsedData.push(o.entity),n.parentCache[o.depth]=o,n.parseGroupData(e[t])}},n.getGrouping=function(o){n.aggCache=[],n.rowCache=[],n.numberOfAggregates=0,n.groupedData={};var i=e.filteredData(),r=o.length,a=e.columns();$.each(i,function(i,d){d[c]=!0;var u=n.groupedData;$.each(o,function(o,i){!a[o].isAggCol&&r>=o&&(e.columns.splice(d.gDepth,0,new t.kg.Column({colDef:{field:"",width:25,sortable:!1,resizable:!1,headerCellTemplate:'<div class="kgAggHeader"></div>'},isAggCol:!0,index:d.gDepth,headerRowHeight:e.config.headerRowHeight})),t.kg.domUtilityService.BuildStyles(e));var n=a.filter(function(e){return e.field==i})[0],c=t.kg.utils.evalProperty(d,i);n.cellFilter&&(c=n.cellFilter(c)),c=c?c.toString():"null",u[c]||(u[c]={}),u[l]||(u[l]=i),u[s]||(u[s]=o),u[g]||(u[g]=n),u=u[c]}),u.values||(u.values=[]),u.values.push(d)}),e.fixColumnIndexes(),n.parsedData.length=0,n.parseGroupData(n.groupedData)},e.config.groups.length>0&&e.filteredData().length>0&&n.getGrouping(e.config.groups)},t.kg.Grid=function(r){var a={rowHeight:35,columnWidth:100,headerRowHeight:36,footerRowHeight:70,footerVisible:!0,displayFooter:void 0,canSelectRows:!0,selectAllState:e.observable(!1),data:e.observableArray([]),columnDefs:void 0,selectedItems:e.observableArray([]),displaySelectionCheckbox:!1,selectWithCheckboxOnly:!1,useExternalSorting:!1,sortInfo:e.observable(void 0),multiSelect:!0,tabIndex:-1,enableColumnResize:!0,enableSorting:!0,maintainColumnRatios:void 0,beforeSelectionChange:function(){return!0},afterSelectionChange:function(){return!0},columnsChanged:function(){},rowTemplate:void 0,headerRowTemplate:void 0,showToolbar:!1,leftToolbarTemplate:void 0,rightToolbarTemplate:void 0,jqueryUITheme:!1,jqueryUIDraggable:!1,plugins:[],keepLastSelected:!0,groups:[],showGroupPanel:!1,enableRowReordering:!1,showColumnMenu:!1,showFilter:!0,disableTextSelection:!0,fixedViewPortHeight:!0,filterOptions:{filterText:e.observable(""),useExternalFilter:!1},enablePaging:!1,pagingOptions:{pageSizes:e.observableArray([10,50,100,500]),pageSize:e.observable(2),totalServerItems:e.observable(0),currentPage:e.observable(1)}},l=this;l.origData=r.data,l.pagedData=e.observableArray([]),l.maxCanvasHt=e.observable(0),l.config=$.extend(a,r),l.config.enablePaging&&(l.config.data=l.pagedData,l.config.useExternalSorting=!0),l.sliceCurrentPageData=function(e){return l.config.pagingOptions.totalServerItems(e().length),e.slice((l.config.pagingOptions.currentPage()-1)*l.config.pagingOptions.pageSize(),l.config.pagingOptions.currentPage()*l.config.pagingOptions.pageSize())},l.config.columnDefs=e.utils.unwrapObservable(r.columnDefs),l.gridId="ng"+t.kg.utils.newId(),l.$root=null,l.$groupPanel=null,l.$topPanel=null,l.$headerContainer=null,l.$headerScroller=null,l.$headers=null,l.$viewport=null,l.$canvas=null,l.rootDim=l.config.gridDim,l.sortInfo=e.isObservable(l.config.sortInfo)?l.config.sortInfo:e.observable(l.config.sortInfo),l.sortedData=l.config.data,l.lateBindColumns=!1,l.filteredData=e.observableArray([]),l.lastSortedColumn=void 0,l.showFilter=l.config.showFilter,l.filterText=l.config.filterOptions.filterText,l.disableTextSelection=e.observable(l.config.disableTextSelection),l.showToolbar=l.config.showToolbar,l.leftToolbarTemplate=l.config.leftToolbarTemplate,l.rightToolbarTemplate=l.config.rightToolbarTemplate,l.config.enablePaging&&(l.pagedDataRefresher=e.computed(function(){l.rowFactory&&l.rowFactory.changeRenderedRangeWithPageSize(l.config.pagingOptions.pageSize()),l.pagedData(l.filterText().length>0?l.filteredData.slice((l.config.pagingOptions.currentPage()-1)*l.config.pagingOptions.pageSize(),l.config.pagingOptions.currentPage()*l.config.pagingOptions.pageSize()):l.origData.slice((l.config.pagingOptions.currentPage()-1)*l.config.pagingOptions.pageSize(),l.config.pagingOptions.currentPage()*l.config.pagingOptions.pageSize()))}),l.config.sortInfo.subscribe(function(e){l.filterText().length>0?l.filteredData(l.filteredData()):l.origData(l.origData())}),l.config.pagingOptions.pageSize.subscribe(function(){l.config.pagingOptions.currentPage(1)},null,"beforeChange")),l.calcMaxCanvasHeight=function(){return l.configGroups().length>0?l.rowFactory.parsedData.filter(function(e){return e[c]===!1}).length*l.config.rowHeight:(l.config.enablePaging?l.pagedData().length:l.filteredData().length)*l.config.rowHeight},l.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0},l.setRenderedRows=function(e){l.renderedRows(e),l.refreshDomSizes()},l.minRowsToRender=function(){var e=l.viewportDimHeight()||1;return Math.floor(e/l.config.rowHeight)},l.refreshDomSizes=function(){l.rootDim.outerWidth(l.elementDims.rootMaxW),l.rootDim.outerHeight(l.elementDims.rootMaxH),l.maxCanvasHt(l.calcMaxCanvasHeight())},l.buildColumnDefsFromData=function(){var e=l.sortedData();if(l.config.columnDefs||(l.config.columnDefs=[]),!e||!e[0])return void(l.lateBoundColumns=!0);var i;i=e[0],t.kg.utils.forIn(i,function(e,t){t!=o&&l.config.columnDefs.push({field:t})})},l.buildColumns=function(){var e=l.config.columnDefs,o=[];e||(l.buildColumnDefsFromData(),e=l.config.columnDefs),l.config.displaySelectionCheckbox&&l.config.canSelectRows&&"✔"!=e[0].field&&e.splice(0,0,{field:"✔",width:l.elementDims.rowSelectedCellW,sortable:!1,resizable:!1,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'}),e.length>0&&($.each(e,function(e,i){var n=new t.kg.Column({colDef:i,index:e,headerRowHeight:l.config.headerRowHeight,sortCallback:l.sortData,resizeOnDataCallback:l.resizeOnData,enableResize:l.config.enableColumnResize,enableSort:l.config.enableSorting},l);o.push(n);var r=l.config.groups.indexOf(i.field);-1!=r&&l.configGroups.splice(r,0,n)}),l.columns(o))},l.configureColumnWidths=function(){var e=l.config.columnDefs,o=e.length,i=[],n=[],r=0,a=0,s=l.columns();if($.each(e,function(e,o){var c=!1,g=void 0;if(t.kg.utils.isNullOrUndefined(o.width)?o.width="*":(c=isNaN(o.width)?t.kg.utils.endsWith(o.width,"%"):!1,g=c?o.width:parseInt(o.width,10)),isNaN(g)){if(g=o.width,"auto"==g){s[e].width=s[e].minWidth;var d=s[e];return void $(document).ready(function(){l.resizeOnData(d,!0)})}if(-1!=g.indexOf("*"))return r+=g.length,o.index=e,void i.push(o);if(c)return o.index=e,void n.push(o);throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'}a+=s[e].width=parseInt(o.width,10)}),i.length>0){l.config.maintainColumnRatios===!1?$.noop():l.config.maintainColumnRatios=!0;var c=l.rootDim.outerWidth()-a,g=Math.floor(c/r);$.each(i,function(e,t){var o=t.width.length;s[t.index].width=g*o,a+=s[t.index].width})}if(n.length>0){var d=l.config.displaySelectionCheckbox?l.rootDim.outerWidth()-l.elementDims.rowSelectedCellW:l.rootDim.outerWidth();$.each(n,function(e,t){var o=t.width;s[t.index].width=Math.floor(d*(parseInt(o.slice(0,-1),10)/100)),a+=s[t.index].width})}if(a!=l.rootDim.outerWidth()-1){var u=1;l.config.fixedViewPortHeight&&l.maxCanvasHt()>l.viewportDimHeight()&&(u+=t.kg.domUtilityService.ScrollW),s[o-1].width+=l.rootDim.outerWidth()-u-a}l.columns(s),t.kg.domUtilityService.BuildStyles(l)},l.init=function(){l.selectionService=new t.kg.SelectionService(l),l.rowFactory=new t.kg.RowFactory(l),l.selectionService.Initialize(l.rowFactory),l.searchProvider=new t.kg.SearchProvider(l),l.styleProvider=new t.kg.StyleProvider(l),l.buildColumns(),t.kg.sortService.columns=l.columns,l.configGroups.subscribe(function(e){if(e){var t=[];$.each(e,function(e,o){o&&t.push(o.field||o)}),l.config.groups=t,l.rowFactory.filteredDataChanged()}}),l.filteredData.subscribe(function(){l.$$selectionPhase||(l.maxCanvasHt(l.calcMaxCanvasHeight()),l.isSorting||l.configureColumnWidths())}),l.maxCanvasHt(l.calcMaxCanvasHeight()),l.searchProvider.evalFilter(),l.refreshDomSizes()},l.prevScrollTop=0,l.prevScrollIndex=0,l.adjustScrollTop=function(e,o){if(l.prevScrollTop!==e||o){var r=Math.floor(e/l.config.rowHeight);l.prevScrollTop<e&&r<l.prevScrollIndex+n||l.prevScrollTop>e&&r>l.prevScrollIndex-n||(l.prevScrollTop=e,l.fixedViewPortHeight&&l.rowFactory.UpdateViewableRange(new t.kg.Range(Math.max(0,r-i),r+l.minRowsToRender()+i)),l.prevScrollIndex=r)}},l.adjustScrollLeft=function(e){l.$headerContainer&&l.$headerContainer.scrollLeft(e),l.$filterContainer&&l.$filterContainer.scrollLeft(e)},l.resizeOnData=function(e){var o=e.minWidth,i=t.kg.utils.getElementsByClassName("col"+e.index);$.each(i,function(e,i){var n;if(0===e){var r=$(i).find(".kgHeaderText");n=t.kg.utils.visualLength(r)+10}else{var a=$(i).find(".kgCellText");n=t.kg.utils.visualLength(a)+10}n>o&&(o=n)}),e.width=o=Math.min(e.maxWidth,o+7),t.kg.domUtilityService.BuildStyles(l)},l.sortData=function(e,o){l.isSorting=!0,l.sortInfo({column:e,direction:o}),l.clearSortingData(e),l.config.useExternalSorting?l.config.sortInfo(l.sortInfo.peek()):t.kg.sortService.Sort(l.sortInfo.peek(),l.sortedData),l.lastSortedColumn=e,l.isSorting=!1},l.clearSortingData=function(e){e?l.lastSortedColumn&&e!=l.lastSortedColumn&&l.lastSortedColumn.sortDirection(""):$.each(l.columns(),function(e,t){t.sortDirection("")})},l.fixColumnIndexes=function(){l.$$indexPhase=!0;var e=l.columns.peek();$.each(e,function(e,t){t.index=e}),l.$$indexPhase=!1},l.elementsNeedMeasuring=!0,
l.columns=e.observableArray([]),l.columns.subscribe(function(e){l.config.columnsChanged(e)}),l.renderedRows=e.observableArray([]),l.headerRow=null,l.rowHeight=l.config.rowHeight,l.jqueryUITheme=e.observable(l.config.jqueryUITheme),l.footer=null,l.selectedItems=l.config.selectedItems,l.multiSelect=l.config.multiSelect,l.footerVisible=t.kg.utils.isNullOrUndefined(l.config.displayFooter)?l.config.footerVisible:l.config.displayFooter,l.config.footerRowHeight=l.footerVisible?l.config.footerRowHeight:0,l.showColumnMenu=l.config.showColumnMenu,l.showMenu=e.observable(!1),l.configGroups=e.observableArray([]),l.enablePaging=l.config.enablePaging,l.pagingOptions=l.config.pagingOptions,l.rowTemplate=l.config.rowTemplate||t.kg.defaultRowTemplate(),l.headerRowTemplate=l.config.headerRowTemplate||t.kg.defaultHeaderRowTemplate(),l.config.rowTemplate&&!d.test(l.config.rowTemplate)&&(l.rowTemplate=t.kg.utils.getTemplatePromise(l.config.rowTemplate)),l.config.headerRowTemplate&&!d.test(l.config.headerRowTemplate)&&(l.headerRowTemplate=t.kg.utils.getTemplatePromise(l.config.headerRowTemplate)),l.visibleColumns=e.computed(function(){var e=l.columns();return e.filter(function(e){var t=e.visible();return t})}),l.nonAggColumns=e.computed(function(){return l.columns().filter(function(e){return!e.isAggCol})}),l.toggleShowMenu=function(){l.showMenu(!l.showMenu())},l.allSelected=l.config.selectAllState,l.allSelected.subscribe(function(e){l.config.beforeSelectionChange(l.sortedData.peek(),this)&&(l.selectionService.toggleSelectAll(e),l.config.afterSelectionChange(l.selectedItems.peek(),this))}),l.totalFilteredItemsLength=e.computed(function(){return l.filteredData().length}),l.showGroupPanel=e.computed(function(){return l.config.showGroupPanel}),l.topPanelHeight=e.observable(l.config.showGroupPanel===!0?2*l.config.headerRowHeight:l.config.headerRowHeight),l.viewportDimHeight=e.computed(function(){return Math.max(0,l.rootDim.outerHeight()-l.topPanelHeight()-24-l.config.footerRowHeight-2)}),l.groupBy=function(e){if(!(l.sortedData().length<1)){var o=l.configGroups().indexOf(e);-1==o?(e.isGroupedBy(!0),l.configGroups.push(e),e.groupIndex(l.configGroups().length)):l.removeGroup(o),t.kg.domUtilityService.BuildStyles(l)}},l.removeGroup=function(e){var o=l.columns().filter(function(t){return t.groupIndex()==e+1})[0];o.isGroupedBy(!1),o.groupIndex(0),l.columns.splice(e,1),l.configGroups.splice(e,1),l.fixGroupIndexes(),0===l.configGroups().length&&l.fixColumnIndexes(),t.kg.domUtilityService.BuildStyles(l)},l.fixGroupIndexes=function(){$.each(l.configGroups(),function(e,t){t.groupIndex(e+1)})},l.totalRowWidth=function(){var e=0,t=l.visibleColumns();return $.each(t,function(t,o){e+=o.width}),e},l.headerScrollerDim=function(){var e=l.viewportDimHeight(),o=l.maxCanvasHt(),i=o>e,n=new t.kg.Dimension;return n.autoFitHeight=!0,n.outerWidth=l.totalRowWidth(),i?n.outerWidth+=l.elementDims.scrollW:o-e<=l.elementDims.scrollH&&(n.outerWidth+=l.elementDims.scrollW),n},l.jqueryUITheme=l.config.jqueryUITheme,l.maxRows=e.observable(Math.max(l.config.pagingOptions.totalServerItems()||l.sortedData().length,1)),l.maxRowsDisplay=e.computed(function(){return l.maxRows()}),l.multiSelect=e.observable(l.config.canSelectRows&&l.config.multiSelect),l.selectedItemCount=e.computed(function(){return l.selectedItems().length}),l.maxPages=e.computed(function(){return l.maxRows(Math.max(l.config.pagingOptions.totalServerItems()||l.sortedData().length,1)),Math.ceil(l.maxRows()/l.pagingOptions.pageSize())}),l.pageRange=function(){var e,t=1,o=l.maxPages(),i=l.pagingOptions.currentPage();5>=o?(e=1,t=o):(e=3>i?1:i-2,t=e+4>o?o:e+4,4>t-e&&(e-=4-(t-e)));for(var n=[],r=e;t>=r;r++)n.push(r);return n},l.pageForward=function(){var e=l.config.pagingOptions.currentPage();l.config.pagingOptions.currentPage(Math.min(e+1,l.maxPages()))},l.pageBackward=function(){var e=l.config.pagingOptions.currentPage();l.config.pagingOptions.currentPage(Math.max(e-1,1))},l.pageToFirst=function(){l.config.pagingOptions.currentPage(1)},l.pageToLast=function(){var e=l.maxPages();l.config.pagingOptions.currentPage(e)},l.cantPageForward=e.computed(function(){var e=l.config.pagingOptions.currentPage(),t=l.maxPages();return!(t>e)}),l.cantPageBackward=e.computed(function(){var e=l.config.pagingOptions.currentPage();return!(e>1)}),l.init()},kg.Range=function(e,t){this.topRow=e,this.bottomRow=t},t.kg.Row=function(i,n,r){var a=this;a.canSelectRows=n.canSelectRows,a.rowClasses=n.rowClasses,a.selectedItems=n.selectedItems,a.entity=i,a.selectionService=r,a.selected=e.observable(!1),a.continueSelection=function(e){a.selectionService.ChangeSelection(a,e)},a.toggleSelected=function(e,t){if(!a.canSelectRows)return!0;var o=t.target||t;return"checkbox"==o.type&&"kgSelectionCheckbox"===o.className&&a.selected(!a.selected()),!n.selectWithCheckboxOnly||"checkbox"==o.type&&"kgSelectionCheckbox"==o.className?a.beforeSelectionChange(a,t)?(a.continueSelection(t),a.afterSelectionChange(a,t)):!1:!0},void 0===a.entity[o]?a.entity[o]=!1:a.selectionService.setSelection(a,a.entity[o]),a.rowIndex=e.observable(0),a.offsetTop=e.observable("0px"),a.rowDisplayIndex=0,a.isEven=e.computed(function(){return a.rowIndex()%2===0?!0:!1}),a.isOdd=e.computed(function(){return a.rowIndex()%2!==0?!0:!1}),a.beforeSelectionChange=n.beforeSelectionChangeCallback,a.afterSelectionChange=n.afterSelectionChangeCallback,a.propertyCache={},a.getProperty=function(e){return a.propertyCache[e]||(a.propertyCache[e]=t.kg.utils.evalProperty(a.entity,e))}},t.kg.SearchProvider=function(o){var i,n=this,r=[];n.extFilter=o.config.filterOptions.useExternalFilter,n.showFilter=o.config.showFilter,n.filterText=o.config.filterOptions.filterText,n.throttle=o.config.filterOptions.filterThrottle,n.fieldMap={},n.evalFilter=function(){e.isObservable(o.config.sortInfo)&&o.config.sortInfo()&&o.config.sortInfo().column&&o.origData().length>0&&t.kg.sortService.Sort(o.config.sortInfo(),o.origData),o.filteredData(0===r.length?o.origData.peek().filter(function(e){return!e._destroy}):o.origData.peek().filter(function(t){if(t._destroy)return!1;for(var o=0,i=r.length;i>o;o++){var a=r[o];if(!a.column){for(var l in t)if(t.hasOwnProperty(l)){var s=e.utils.unwrapObservable(t[l]);if(s&&a.regex.test(s.toString()))return!0}return!1}var c=e.utils.unwrapObservable(t[a.column])||e.utils.unwrapObservable(t[n.fieldMap[a.columnDisplay]]);if(a.columnDef&&a.columnDef.cellFilter&&(c=a.columnDef.cellFilter(c)),!c||!a.regex.test(c.toString()))return!1}return!0})),o.rowFactory.filteredDataChanged()};var a=function(e,t){try{return new RegExp(e,t)}catch(o){return new RegExp(e.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}},l=function(e){r=[];var t;if(t=$.trim(e)){var o=t.split(";");$.each(o,function(e,t){var o=t.split(":");if(o.length>1){var i=$.trim(o[0]),n=$.trim(o[1]);if(i&&n){var l=s(i);r.push({columnDef:l,column:i,columnDisplay:i.replace(/\s+/g,"").toLowerCase(),regex:a(n,"i")})}}else{var c=$.trim(o[0]);c&&r.push({column:"",regex:a(c,"i")})}})}},s=function(e){var t;return $.each(o.columns(),function(o,i){return e==i.displayName()?(t=i,!1):void 0}),t},c=e.computed(function(){var e=n.filterText();n.extFilter||e==i||(i=e,l(e),n.evalFilter())});"number"==typeof n.throttle&&c.extend({throttle:n.throttle}),n.extFilter||o.columns.subscribe(function(e){$.each(e,function(e,t){n.fieldMap[t.displayName().toLowerCase().replace(/\s+/g,"")]=t.field})})},t.kg.SelectionService=function(e){var t=this;t.multi=e.config.multiSelect,t.selectedItems=e.config.selectedItems,t.selectedIndex=e.config.selectedIndex,t.lastClickedRow=void 0,t.ignoreSelectedItemChanges=!1,t.rowFactory={},t.Initialize=function(e){t.rowFactory=e},t.ChangeSelection=function(i,n){if(e.$$selectionPhase=!0,n&&n.shiftKey&&t.multi){if(t.lastClickedRow){var r=e.filteredData.indexOf(i.entity),a=e.filteredData.indexOf(t.lastClickedRow.entity);if(r==a)return!1;a++,a>r&&(r^=a,a=r^a,r^=a);for(var l=[];r>=a;a++)l.push(t.rowFactory.rowCache[a]);return l[l.length-1].beforeSelectionChange(l,n)&&($.each(l,function(e,i){i.selected(!0),i.entity[o]=!0,-1===t.selectedItems.indexOf(i.entity)&&t.selectedItems.push(i.entity)}),l[l.length-1].afterSelectionChange(l,n)),t.lastClickedRow=l[l.length-1],!0}}else t.multi?t.setSelection(i,!i.selected()):(t.lastClickedRow&&t.lastClickedRow!=i&&t.setSelection(t.lastClickedRow,!1),t.setSelection(i,e.config.keepLastSelected?!0:!i.selected()));return t.lastClickedRow=i,e.$$selectionPhase=!1,!0},t.setSelection=function(e,i){if(e.selected(i),e.entity[o]=i,i)-1===t.selectedItems.indexOf(e.entity)&&t.selectedItems.push(e.entity);else{var n=t.selectedItems.indexOf(e.entity);t.selectedItems.splice(n,1)}},t.toggleSelectAll=function(i){var n=t.selectedItems().length;n>0&&t.selectedItems.splice(0,n),$.each(e.filteredData(),function(e,n){n[o]=i,i&&t.selectedItems.push(n)}),$.each(t.rowFactory.rowCache,function(e,t){t&&t.selected&&t.selected(i)})}},t.kg.StyleProvider=function(o){o.canvasStyle=e.computed(function(){return{height:o.maxCanvasHt().toString()+"px"}}),o.headerScrollerStyle=e.computed(function(){return{height:o.config.headerRowHeight+"px"}}),o.topPanelStyle=e.computed(function(){return{width:o.rootDim.outerWidth()-2+"px",height:o.topPanelHeight()+"px"}}),o.headerStyle=e.computed(function(){return{width:Math.max(0,o.rootDim.outerWidth()-t.kg.domUtilityService.ScrollW)+"px",height:o.config.headerRowHeight+"px"}}),o.viewportStyle=e.computed(function(){return o.config.fixedViewPortHeight?{width:o.rootDim.outerWidth()+"px",height:o.viewportDimHeight()+"px"}:{width:o.rootDim.outerWidth()+"px"}}),o.footerStyle=e.computed(function(){return{width:o.rootDim.outerWidth()+"px",height:o.config.footerRowHeight+"px"}})},t.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(e){var o,i,n,r,a;if(void 0===e||null===e||""===e)return null;switch(i=typeof e){case"number":o=t.kg.sortService.sortNumber;break;case"boolean":o=t.kg.sortService.sortBool;break;default:o=void 0}return o?o:"[object Date]"===Object.prototype.toString.call(e)?t.kg.sortService.sortDate:"string"!==i?t.kg.sortService.basicSort:e.match(/^-?[�$�]?[\d,.]+%?$/)?t.kg.sortService.sortNumberStr:(n=e.match(t.kg.sortService.dateRE),n?(r=parseInt(n[1],10),a=parseInt(n[2],10),r>12?t.kg.sortService.sortDDMMStr:a>12?t.kg.sortService.sortMMDDStr:t.kg.sortService.sortMMDDStr):t.kg.sortService.sortAlpha)},basicSort:function(e,t){return e==t?0:t>e?-1:1},sortNumber:function(e,t){return e-t},sortNumberStr:function(e,t){var o,i,n=!1,r=!1;return o=parseFloat(e.replace(/[^0-9.-]/g,"")),isNaN(o)&&(n=!0),i=parseFloat(t.replace(/[^0-9.-]/g,"")),isNaN(i)&&(r=!0),n&&r?0:n?1:r?-1:o-i},sortAlpha:function(e,t){var o=e.toLowerCase(),i=t.toLowerCase();return o==i?0:i>o?-1:1},sortBool:function(e,t){return e&&t?0:e||t?e?1:-1:0},sortDate:function(e,t){var o=e.getTime(),i=t.getTime();return o==i?0:i>o?-1:1},sortDDMMStr:function(e,o){var i,n,r,a,l,s;return r=e.match(t.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,r=o.match(t.kg.sortService.dateRE),s=r[3],a=r[2],l=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,i==n?0:n>i?-1:1},sortMMDDStr:function(e,o){var i,n,r,a,l,s;return r=e.match(t.kg.sortService.dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),i=s+a+l,r=o.match(dateRE),s=r[3],l=r[2],a=r[1],1==a.length&&(a="0"+a),1==l.length&&(l="0"+l),n=s+a+l,i==n?0:n>i?-1:1},sortData:function(e,o){var i=e();if(i&&o){var n,a,l=o.column,s=o.direction;if(t.kg.sortService.colSortFnCache[l.field])n=t.kg.sortService.colSortFnCache[l.field];else if(void 0!=l.sortingAlgorithm)n=l.sortingAlgorithm,t.kg.sortService.colSortFnCache[l.field]=l.sortingAlgorithm;else{if(a=i[0],!a)return;n=kg.sortService.guessSortFn(a[l.field]),n?t.kg.sortService.colSortFnCache[l.field]=n:n=t.kg.sortService.sortAlpha}i.sort(function(e,o){var i=t.kg.utils.evalProperty(e,l.field),a=t.kg.utils.evalProperty(o,l.field);return l.cellFilter&&(i=l.cellFilter(i),a=l.cellFilter(a)),a||i?i?a?s===r?n(i,a):0-n(i,a):-1:1:0}),e(i)}},Sort:function(e,o){t.kg.sortService.isSorting||(t.kg.sortService.isSorting=!0,t.kg.sortService.sortData(o,e),t.kg.sortService.isSorting=!1)}};var u=function(){var e=$("<div></div>");e.appendTo("body"),e.height(100).width(100).css("position","absolute").css("overflow","scroll"),e.append('<div style="height: 400px; width: 400px;"></div>'),t.kg.domUtilityService.ScrollH=e.height()-e[0].clientHeight,t.kg.domUtilityService.ScrollW=e.width()-e[0].clientWidth,e.empty(),e.attr("style",""),e.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>'),t.kg.domUtilityService.LetterW=e.children().first().width(),e.remove()};t.kg.domUtilityService={AssignGridContainers:function(e,o){o.$root=$(e),o.$topPanel=o.$root.find(".kgTopPanel"),o.$groupPanel=o.$root.find(".kgGroupPanel"),o.$headerContainer=o.$topPanel.find(".kgHeaderContainer"),o.$headerScroller=o.$topPanel.find(".kgHeaderScroller"),o.$filterContainer=o.$root.find(".kgFilter"),o.$headers=o.$headerScroller.children(),o.$viewport=o.$root.find(".kgViewport"),o.$canvas=o.$viewport.find(".kgCanvas"),o.$footerPanel=o.$root.find(".ngFooterPanel"),t.kg.domUtilityService.UpdateGridLayout(o)},UpdateGridLayout:function(e){var t=e.$viewport.scrollTop();e.elementDims.rootMaxW=e.$root.width(),e.elementDims.rootMaxH=e.$root.height(),e.refreshDomSizes(),e.adjustScrollTop(t,!0)},BuildStyles:function(e){var o,i=e.config.rowHeight,n=e.$styleSheet,r=e.gridId,a=e.visibleColumns(),l=0;n||(n=$("#"+r),n[0]||(n=$("<style id='"+r+"' type='text/css' rel='stylesheet' />"),n.appendTo("body"))),n.empty();var s=e.totalRowWidth();o="."+r+" .kgCanvas { width: "+s+"px; }."+r+" .kgRow { width: "+s+"px; }."+r+" .kgCell { height: "+i+"px; }."+r+" .kgCanvas { width: "+s+"px; }."+r+" .kgHeaderCell { top: 0; bottom: 0; }."+r+" .kgHeaderScroller { width: "+(s+t.kg.domUtilityService.scrollH+2)+"px}",$.each(a,function(e,t){o+="."+r+" .col"+e+" { width: "+t.width+"px; left: "+l+"px; right: "+(s-l-t.width)+"px; height: "+i+"px }."+r+" .colt"+e+" { width: "+t.width+"px; }",l+=t.width}),t.kg.utils.isIe?n[0].styleSheet.cssText=o:n.append(document.createTextNode(o)),e.$styleSheet=n},ScrollH:17,ScrollW:17,LetterW:10},u()}(window)});