!function(e){var i=0,t={resizeMaxTry:4,resizeWaitTime:50,minimumHeight:200,defaultHeight:3e3,heightOffset:0,exceptPages:"",debugMode:!1,visibilitybeforeload:!1,blockCrossDomain:!1,externalHeightName:"bodyHeight",onMessageFunctionName:"getHeight",domainName:"*",watcher:!1,watcherTime:400};e.iframeHeight=function(t,o){var n=this;e.iframeHeight.resizeTimeout=null,e.iframeHeight.resizeCount=0,n.$el=e(t),n.el=t,n.$el.before("<div id='iframeHeight-Container-"+i+"' style='padding: 0; margin: 0; border: none; background-color: transparent;'></div>"),n.$el.appendTo("#iframeHeight-Container-"+i),n.$container=e("#iframeHeight-Container-"+i),n.$el.data("iframeHeight",n),n.watcher=null,n.debug={FirstTime:!0,Init:function(){"console"in window||(console={}),"log info warn error dir clear".replace(/\w+/g,function(e){e in console||(console[e]=console.log||new Function)})},Log:function(e){this.FirstTime&&this.FirstTime===!0&&(this.Init(),this.FirstTime=!1),n.options.debugMode&&n.options.debugMode===!0&&console&&(null!==e||""!==e)&&console.log("Iframe Plugin : "+e)},GetBrowserInfo:function(e){var i,t,o=function(e){e=e.toLowerCase();var i=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browserObj:i[1]||"",version:i[2]||"0"}};return i=o(navigator.userAgent),t={chrome:!1,safari:!1,mozilla:!1,msie:!1,webkit:!1},i.browserObj&&(t[i.browserObj]=!0,t.version=i.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),e=t}(this.GetBrowserInfo||{})};var r=function(){try{var e;return e=n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version?n.$el.get(0).contentWindow.location.href:n.$el.get(0).contentDocument.location.href,n.debug.Log("This page is non-Cross Domain - "+e),!1}catch(i){return n.debug.Log("This page is Cross Domain"),!0}};n.resetIframe=function(){!n.options.visibilitybeforeload||n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version||n.$el.css("visibility","hidden"),n.debug.Log("Old Height is "+n.$el.height()+"px"),n.$el.css("height","").removeAttr("height"),n.debug.Log("Reset iframe"),n.debug.Log("Height is "+n.$el.height()+"px after reset")},n.resizeFromOutside=function(e){if(n.options.blockCrossDomain)return n.debug.Log("Blocked cross domain fix"),!1;if("undefined"==typeof e)return!1;if("string"!=typeof e.data)return!1;if("reset"==e.data)n.$el.css("height","").removeAttr("height");else{if(!/^ifh*/.test(e.data))return!1;if("number"!=typeof parseInt(e.data.substring(3)))return!1;var i=parseInt(e.data.substring(3))+parseInt(n.options.heightOffset);n.resetIframe(),n.setIframeHeight(i)}return!0},n.checkMessageEvent=function(){if(n.options.blockCrossDomain||n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version)return n.debug.Log("Blocked cross domain fix"),!1;n.resetIframe(),!n.options.visibilitybeforeload||n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version||n.$el.css("visibility","visible"),window.addEventListener?window.addEventListener("message",n.resizeFromOutside,!1):window.attachEvent&&window.attachEvent("onmessage",n.resizeFromOutside),n.$el.id||(n.$el.id="iframe-id-"+ ++i);var e=document.getElementById(n.$el.attr("id")),t=n.options.onMessageFunctionName;return e.contentWindow.postMessage?(e.contentWindow.postMessage(t,"*"),n.debug.Log("Cross Domain Iframe started"),!0):(n.debug.Log("Your browser does not support the postMessage method!"),!1)};var s=function(){e.iframeHeight.resizeCount<=n.options.resizeMaxTry?(e.iframeHeight.resizeCount++,e.iframeHeight.resizeTimeout=setTimeout(e.iframeHeight.resizeIframe,n.options.resizeWaitTime),n.debug.Log(e.iframeHeight.resizeCount+" time(s) tried")):(clearTimeout(e.iframeHeight.resizeTimeout),e.iframeHeight.resizeCount=0,n.debug.Log("set default height for iframe"),n.setIframeHeight(n.options.defaultHeight+n.options.heightOffset))};n.sendInfotoTop=function(){if(top.length>0&&"undefined"!=typeof JSON){var i={};i[n.options.externalHeightName].value=e(document).height();var t="*";return i=JSON.stringify(i),top.postMessage(i,t),n.debug.Log("sent info to top page"),!1}return!0},n.setIframeHeight=function(e){n.$el.height(e).css("height",e),n.$el.data("iframeheight")!=e&&n.$container.height(e).css("height",e),!n.options.visibilitybeforeload||n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version||n.$el.css("visibility","visible"),n.debug.Log("Now iframe height is "+e+"px"),n.$el.data("iframeheight",e)},e.iframeHeight.resizeIframe=function(){if(n.resetIframe(),r())n.$el.height(n.options.defaultHeight+n.options.heightOffset).css("height",n.options.defaultHeight+n.options.heightOffset),!n.options.visibilitybeforeload||n.debug.GetBrowserInfo.msie&&"7.0"==n.debug.GetBrowserInfo.version||n.$el.css("visibility","visible"),n.checkMessageEvent();else if(n.$el.css("height")===n.options.minimumHeight+"px"&&n.resetIframe(),null!==n.$el.get(0).contentWindow.document.body){n.debug.Log("This page has body info");var i=e(n.$el.get(0).contentWindow.document).height(),t=n.$el.get(0).contentWindow.document.location.pathname.substring(n.$el.get(0).contentWindow.document.location.pathname.lastIndexOf("/")+1).toLowerCase();n.debug.Log("page height : "+i+"px || page name : "+t),i<=n.options.minimumHeight&&-1==n.options.exceptPages.indexOf(t)?s():i>n.options.minimumHeight&&-1==n.options.exceptPages.indexOf(t)&&n.setIframeHeight(i+n.options.heightOffset)}else n.debug.Log("This page has not body info"),s()},this.$el.bind("updateIframe",function(){e.iframeHeight.resizeIframe(),n.debug.Log("Updated Iframe Manually")}),this.$el.bind("killWatcher",function(){window.clearInterval(n.watcher),n.debug.Log("Killed Watcher")}),n.init=function(){return n.options=e.extend({},e.iframeHeight.defaultOptions,o),1==n.options.watcher&&(n.options.blockCrossDomain=!0),n.debug.Log(n.options),void 0===n.$el.get(0).tagName||"iframe"!==n.$el.get(0).tagName.toLowerCase()?(n.debug.Log("This element is not iframe!"),!1):(e.iframeHeight.resizeIframe(),n.$el.on("load",function(){e.iframeHeight.resizeIframe()}),n.options.watcher&&(n.watcher=setInterval(function(){e.iframeHeight.resizeIframe(),n.debug.Log("Checked Iframe")},n.options.watcherTime)),!0)},n.init()},e.iframeHeight.defaultOptions=t,e.fn.iframeHeight=function(i){return this.each(function(){new e.iframeHeight(this,i)})},e.iframeHeightExternal=function(){function i(i){var o;if("domain"in i&&(o=i.domain),"origin"in i&&(o=i.origin),"*"!==t.domainName&&o!==t.domainName)return void e.iframeHeight.debug.Log("It's not same domain. Blocked!");if(i.data==t.onMessageFunctionName){var n="ifh"+e(document).height();i.source.postMessage(n,i.origin)}}return 1===arguments.length&&e.isPlainObject(arguments[0])&&(t=e.extend({},e.iframeHeight.defaultOptions,arguments[0])),window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent&&window.attachEvent("onmessage",i),{update:function(){this.reset(),window.__domainname=t.domainName,setTimeout(function(){var i="ifh"+e(document).height();parent.postMessage(i,window.__domainname)},90)},reset:function(){parent.postMessage("reset",t.domainName)}}}}(jQuery);