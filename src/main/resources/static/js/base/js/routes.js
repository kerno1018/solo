define(["jquery","knockout","./app","sammy","user","modules/init_modules"],function(e,t,n,o,i,a){function r(){var a=this;a.routeConfig={},a.loadNavigationRoutes=function(t,n){t=t||[];var o=require.toUrl("navigation.json");e.getJSON(o,function(e){var o=e.filter(function(e){return(e.providerOnly?"Oracle"==i.userType():!0)&&(e.userType?e.userType.indexOf(i.userType())>=0:!0)&&(!e.privilege||a.isPrivilegePresent(t,e))});a.configureRoutes(o),n()})},a.isPrivilegePresent=function(e,t){var n;if(t.privilege)if(t.privilege.indexOf("|")>=0){var o=t.privilege.split("|");o.forEach(function(t){return e.indexOf(t.trim())>=0?void(n=!0):void 0})}else n=e.indexOf(t.privilege)>=0?!0:!1;return n},a.configureRoutes=function(i){function r(t){if(t){var n=t.split("|");t=n[0].trim(),e("#navbar > ul > li > a > span:not(.caret)").each(function(){var n=e(this);return t==n.text()?n.parents("li").addClass("active"):n.parents("li").removeClass("active"),!0}),t=n[n.length-1].trim(),e("#dl-menu ul.nav.nav-sidebar li a span").each(function(){var n=e(this);return t==n.text()?n.parents("a").addClass("active"):n.parents("a").removeClass("active"),!0})}}"string"==typeof i&&(i=JSON&&JSON.parse(i)||e.parseJSON(i)),a.routeConfig={},e.each(i,function(e,t){a.routeConfig[t.path]=t}),a.routes=new o(function(){var o=function(){var o=this,i="#"+o.path.split("#")[1],u=a.routeConfig[i];if(!u){var l=a.routes.lookupRoute(o.verb,o.path);u=a.routeConfig[l.originalPath]}if(!u.module)throw new Error("Missing module property in navigation.json for "+o.path);e.each(u.pageFragments,function(n,i){i.viewModelNamePath=i.viewModelNamePath&&0!==i.viewModelNamePath.indexOf("modules/")?__MODULE_PREFIX__(u.module,i.viewModelNamePath):i.viewModelNamePath,i.templateNamePath=i.templateNamePath&&0!==i.templateNamePath.indexOf("modules/")?__MODULE_PREFIX__(u.module,i.templateNamePath):i.templateNamePath,e(i.scope).each(function(n,a){i.viewModelNamePath?require([i.viewModelNamePath],function(n){var r=e.Deferred();if(r.done(function(){t.applyBindingsToNode(a,{template:{name:i.templateNamePath,data:n,afterRender:i.afterRender&&"function"==typeof n[i.afterRender]?n[i.afterRender]:null}}),i.afterRouting&&"function"==typeof n[i.afterRouting]&&n[i.afterRouting](o)}),i.beforeRouting&&"function"==typeof n[i.beforeRouting]){var u=n[i.beforeRouting](o);u&&"function"==typeof u.then?u.done(function(){r.resolve()}):r.resolve()}else r.resolve()}):t.applyBindingsToNode(a,{template:{name:i.templateNamePath}})})}),u.menu&&(n.nagivationMenu.reloadSideMenuOfModule(u.menu,void 0===u.hideSideMenu?!0:u.hideSideMenu),r(u.menu),e("#navbar .dropdown-menu, .user-dropdown .dropdown-menu").trigger("click"))};for(var i in a.routeConfig)if(console.log("define route path: "+i),"#"!==i){this.route(a.routeConfig[i].verb?a.routeConfig[i].verb:"get",i.split("?")[0],o);var u=a.routes.routes[a.routeConfig[i].verb];u[u.length-1].originalPath=i}}),n.nagivationMenu.generateMenu(i)},a.routes=new o(function(){this.get("#/login",function(){require(["user-validation"],function(e){i.userLoggedIn()||e.isLoggedIn()?location.hash="#/commonDashboard":n.template({pageTemplate:"login",templateData:e})})}),this.get("#/logout",function(){require(["user-validation"],function(e){e.logout(),location.hash="#/login"})}),this.notFound=function(){this.last_location[1]&&"/"===this.last_location[1].split("#")[1].charAt(0)&&t.applyBindingsToNode(e("#mainContent")[0],{template:{name:"modules/base/templates/page_not_found"}})}}),a.runDefault=function(e){a.routes.run(e?e:u)}}console.log("defining routes...");var u="#/dashboard";return new r});