define(["jquery","knockout","user","alert-utils","ko-validation-util","moment-timezone"],function(e,s,a,r,o,n){function t(){function o(e){var s=n(),a=null;return e?(a=n(new Date(e)),n.duration(s.diff(a)).asSeconds()):0}var t=this;t.credential=a,t.inProgress=s.observable(!1),t.currentPassword=s.observable().extend({required:!0}),t.newPassword=s.observable().extend({required:!0,passwordComplexity:!0}),t.confirmPassword=s.observable().extend({required:!0,areSame:t.newPassword}),t.bttnDisabled=s.computed(function(){return!(t.currentPassword.isValid()&&t.newPassword.isValid()&&t.confirmPassword.isValid()&&t.currentPassword().length>0&&t.newPassword().length>0&&t.confirmPassword().length>0)}),t.alertMessage=s.observable(""),t.isLoggedIn=function(s,r){e.ajax({type:"GET",url:"rest/userservice/is_user_login",dataType:"json",contentType:"application/json; charset=utf-8",global:!1,success:function(e,n,t){e&&e.isloggedin?(a.id(e.id),a.userLoggedIn(e.isloggedin),a.userName(e.username),a.userId(e.userid),a.firstName(e.firstname),a.lastName(e.lastname),a.email(e.email),a.phoneNumber(e.phonenumber),a.timeZone(e.timezone),a.dateFormat(e.dateformat),a.timeFormat(e.timeformat),a.status(e.status),a.userType(e.usertype),a.privileges(e.privileges),a.services(e.services),a.csi=e.csi,a.timeDrift(o(t.getResponseHeader("Date"))),s(e.privileges,e.services)):r()},error:function(e,s,a){r(),a.processed=!0}})},t.modalHTML='<div class="modal" id="changePasswordModal" tabindex="-1" role="dialog" aria-hidden="false">                                <div class="modal-dialog">                                    <div class="modal-content">                                        <div class="modal-header">                                            <div class="form-title">                                                <div class="fa-lock orange icon"></div>                                                    <h1>Change Password</h1><h2>Enter a current password and confirm the new one.</h2>                                                    <button type="button" class="close" data-bind="click:closeModal" aria-label="Close">                                                        <span aria-hidden="true">&times;</span>                                                    </button>                                                </div>                                            </div>                                            <div class="alert-danger" role="alert" data-bind="css: {\'hidden\': alertMessage().length == 0}">                                                <div class="alert-icon"></div>                                                    <p data-bind="html:alertMessage"></p>                                                </div>                                            <div class="modal-body">                                                <div class="col-md-12 col-sm-12 form-group no-padding">                                                    <div class="row">                                                        <acs-password params="label: \'Current Password\',                                                            title: \'Enter your current password\',value: currentPassword,                                                            id: \'current_password\'"></acs-password></div>                                                    <div class="row">                                                        <acs-password params="label: \'New Password\',                                                            title: \'Password must be between 6 and 32 characters long and contain three of the following 4 items: upper case letter, lower case letter, a symbol, a number\',value: newPassword,                                                            id: \'new_password\'"></acs-password></div>                                                    <div class="row">                                                        <acs-password params="label: \'Confirm Password\',                                                            title: \'Confirm the new password\',                                                            value: confirmPassword,id: \'confirm_password\'"></acs-password></div>                                                </div>                                            </div>                                            <div class="modal-footer">                                                <div class="button-con"><div class="float-right">                                                    <acs-button params="label: \'Change\',action: changePassword,                                                        disabled: bttnDisabled,icon_class: \'fa fa-check\', icon_position:\'left\',                                                        btn_class: \'btn btn-primary\',id: \'change_password_bttn\',loading: inProgress"></acs-button>                                                    <acs-sec-button params="label: \'Cancel\', id: \'close_modal_bttn\',                                                        click_action: closeModal, btn_type: \'anchor\'"></acs-sec-button></div>                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                            </div>',t.passwordModal=e(t.modalHTML),t.logout=function(){e.ajax({type:"GET",url:"rest/userservice/user_logout",dataType:"json",contentType:"application/json; charset=utf-8"}),a.userLoggedIn(!1),a.userName(null),a.userId(null),window.location.href="login.html"},t.hasPrivilege=function(e){return a.privileges()&&a.privileges().indexOf(e)>=0},t.hasService=function(e){for(var s=a.services(),r=0;r<s.length;r++)if(s[r].service_id===e||s[r].service_code===e||s[r].service_name===e)return!0;return!1},t.hasServiceCategory=function(e){for(var s=a.services(),r=0;r<s.length;r++)if(s[r].category_id===e||s[r].category_name===e)return!0;return!1},t.changePassword=function(){{var a={currentPassword:t.currentPassword(),newPassword:t.newPassword()};s.validation.group(a,{evaluate:!0})}if(a.errors().length>0)return void t.alertMessage("<b>Error:</b>&nbsp;<span>Validation failed. Please see the errors below the input fields.</span>");var o=s.toJS(a);delete o.errors,t.inProgress(!0),e.ajax({type:"POST",url:"rest/usermgmtservice/changePassword",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),success:function(e,s,a){r.showSuccessAlert("Password has been changed."),t.closeModal(),t.inProgress(!1)},complete:function(){t.inProgress(!1)}})},t.closeModal=function(){e(t.passwordModal).modal("hide"),s.cleanNode(document.getElementById("changePasswordModal")),t.resetFields()},t.showModal=function(){e(t.passwordModal).modal({backdrop:"static",keyboard:!1}).modal("show"),s.applyBindings(t,document.getElementById("changePasswordModal"))},t.resetFields=function(){t.currentPassword(""),t.currentPassword.clearError(),t.newPassword(""),t.newPassword.clearError(),t.confirmPassword(""),t.confirmPassword.clearError(),t.alertMessage("")}}return console.log("defining user login module..."),new t});