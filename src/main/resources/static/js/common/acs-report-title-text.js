define(["jquery","knockout","signal-emitter"],function(e,t,i){!function(e,t){"use strict";var i=e(t),n=!1,s=!1,a="data-edit-event",o="data-is-editing",r="data-is-empty",l="dbltap",d="ontouchend"in t,c="tinyMCE"in t&&"function"==typeof t.tinyMCE.init,b=e.fn.is,u=0,h=function(){var t=(new Date).getTime();250>t-u&&e(this).trigger(l),u=t},f=function(e){if(13==e.keyCode&&e.data.closeOnEnter)s.editable("close");else if(e.data.toggleFontSize&&e.metaKey&&(38==e.keyCode||40==e.keyCode)){var t=parseInt(n.css("font-size"),10);return t+=40==e.keyCode?-1:1,n.css("font-size",t+"px"),!1}},g=function(){n[0].scrollHeight!==parseInt(n.attr("data-scroll"),10)&&(n.css("height",n[0].scrollHeight+"px"),n.attr("data-scroll",n[0].scrollHeight))},p=function(e,t,i){e.removeAttr(o),0==t.length&&i?(e.html(i),e.attr(r,"empty")):(e.html(t),e.removeAttr(r)),n.remove()},v=function(t,a){if(!t.is(":editing")){s=t,t.attr(o,"1"),t.is(":empty")&&(t.removeAttr(r),t.html(""));var l=e.trim(t.html()),d=t.css("font-size"),c=1.2*t.height(),b="width: 70%; margin:0; border:0; background:none;font-family: "+t.css("font-family")+"; font-size: "+t.css("font-size")+";font-weight: "+t.css("font-weight")+";";a.lineBreaks&&(l=l.replace(/<br( |)(|\/)>/g,"\n")),n=e("<textarea></textarea>"),t.text(""),null!==navigator.userAgent.match(/webkit/i)&&(b=document.defaultView.getComputedStyle(t.get(0),"").cssText),b+="position: static; width: 70%; border:1px solid #eee; padding: 5px;",a.tinyMCE!==!1||((a.toggleFontSize||a.closeOnEnter)&&i.bind("keydown",a,f),i.bind("keyup",g),n.val(l).blur(function(){if(n.is(y))return n.focus(),!0;s=!1;var o=e.trim(n.val()),r=n.css("font-size");a.lineBreaks&&(o=o.replace(new RegExp("\n","g"),"<br />")),p(t,o,a.emptyMessage),r!=d&&t.css("font-size",r),i.unbind("keydown",f),i.unbind("keyup",g),"function"==typeof a.callback&&a.callback({content:o==l?!1:o,fontSize:r==d?!1:r,$el:t})}).attr("style",b).appendTo(t).css({margin:0,height:c+"px",overflow:"hidden"}).css(a.editorStyle).focus().get(0).select(),g()),t.trigger("edit",[n])}},m=function(t){return s!==!1?(s.editable("close"),v(e(this),t.data)):v(e(this),t.data),!1};e.fn.editable=function(t){if("string"==typeof t)if(this.is(":editable"))switch(t){case"open":this.is(":editing")||this.trigger(this.attr(a));break;case"close":this.is(":editing")&&n.trigger("blur");break;case"destroy":this.is(":editing")&&n.trigger("blur"),this.unbind(this.attr(a)),this.removeAttr(a);break;default:console.warn('Unknown command "'+t+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first");else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),t=e.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,emptyMessage:!1,tinyMCE:!1,editorStyle:{}},t),t.tinyMCE===!1||c||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),t.tinyMCE=!1),d&&t.touch?(t.event=l,this.unbind("touchend",h),this.bind("touchend",h)):t.event+=".textEditor",this.bind(t.event,t,m),this.attr(a,t.event),0==this.html().length&&t.emptyMessage?(this.html(t.emptyMessage),this.attr(r,"empty")):this.removeAttr(r);return this},e.fn.is=function(e){if("string"==typeof e&&0===e.indexOf(":")){if(":editable"==e)return void 0!==this.attr(a);if(":editing"==e)return void 0!==this.attr(o);if(":empty"==e)return void 0!==this.attr(r)}return b.apply(this,arguments)};var y;e(document).mousedown(function(t){y=e(t.target)})}(jQuery,window);var n=function(n,s){var a="undefined"==typeof n.customizationEnabled?!1:n.customizationEnabled,o=t.observable(!1),r=t.unwrap(n.placeholder),l=n.value?t.isObservable(n.value)?n.value:t.observable(n.value):t.observable(),d=t.isObservable(n.visible)?n.visible:t.observable("undefined"==typeof n.visible?!0:n.visible),c=t.observable(n.css),b=t.unwrap(n.broadcast_change),u=t.observable(n.large),h=function(){var t=e("._editor_",s.element);t.editable({touch:!0,lineBreaks:!0,toggleFontSize:!1,closeOnEnter:!0,callback:function(e){return e.content&&(l(e.content),f()),o(!1),t.editable("destroy"),e.content}}),t.editable("open"),o(!0)},f=function(){b&&i.dispatch("Report-Component-Param-Changed",[s.element,"value",l()])};return i.addListener("Report-Template-Attr-Changed:"+s.element.id,function(e,t,i){"visible"===t&&d(i)},this),{visible:d,showCustomization:t.isObservable(a)?a:t.observable(a),inEditMode:o,beginEdit:h,value:l,css:c,large:u,icon:n.icon,placeholder:r}};return{viewModel:{createViewModel:n},template:'<h3 data-bind="visible: visible() || showCustomization(), css: (!visible() & showCustomization()) ? \'opaque\': css(), style: { fontSize: large() === true ? \'25px\' : \'21px\' }">\r\n                            <span class="bg-blue-light icon fa" style="color: #fff;border-radius: 50%;height: 40px;width: 40px;font-size: 20px;padding: 10px 0;text-align: center" data-bind="visible: icon, css: icon"></span>\r\n                            <span class="_editor_" data-bind="text: value() ? value() : placeholder"></span>\r\n                            <span class="field-action" data-bind="if: !inEditMode() && showCustomization()">\r\n                                 <a href="javascript:void(0)" data-bind="click: beginEdit"><span class="fa-pencil fa pull-left"></span>Edit</a>\r\n                            </span>\r\n                        </h3>'}});