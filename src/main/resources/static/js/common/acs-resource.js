"use strict";var ACSRestResource=function(t){if(!t.url)throw"url option is required when creating ACSRestResource";if(this._config={rootUrl:"rest/",localStorage:!1,idAttribute:"id",global:!0},this._config=$.extend(this._config,t),this._headers=this._config.headers,this._config.fullUrl="/"!==this._config.url[0]?this._normalizeUrl(this._config.rootUrl)+"/"+this._normalizeUrl(this._config.url):this._normalizeUrl(this._config.url),this._config.localStorageKey="acs-rsc-"+this._config.fullUrl,this._store={},this._config.localStorage){var e=window.localStorage.getItem(this._config.localStorageKey);e&&this._set(JSON.parse(e),{silent:!0})}};ACSRestResource.prototype.ajax=$.ajax,ACSRestResource.prototype._normalizeUrl=function(t){return t?t.replace(/\/+$/,""):t},ACSRestResource.prototype._getURI=function(t){var e=this._config.fullUrl;return t&&this._config.idAttribute in t&&(e+="/"+t[this._config.idAttribute],delete t[this._config.idAttribute]),e},ACSRestResource.prototype._set=function(t){var e=this._store?this._store:this._store={},r=!1;if("undefined"==typeof t)return t;if("string"===$.type(t))try{t=JSON.parse(t)}catch(i){throw"Invalid JSON from the API response."}return"array"!==$.type(t)&&(this._config.parse?(t=this._config.parse(t),"array"!==$.type(t)&&(t=[t],r=!0)):(t=[t],r=!0)),$.each(t,function(t,r){e[r[this._config.idAttribute]]=r}.bind(this)),r&&1===t.length?t[0]:t},ACSRestResource.prototype._setAjax=function(t){return this._set(t)},ACSRestResource.prototype._remove=function(t){"object"===$.type(t)?delete this._store[t[this._config.idAttribute]]:delete this._store[t]},ACSRestResource.prototype._validateURI=function(t){return t&&"/"===t[0]?this._normalizeUrl(t):this._normalizeUrl(this._config.rootUrl)+"/"+this._normalizeUrl(t)},ACSRestResource.prototype._get=function(t,e,r){var i={type:"GET",url:t,data:e,headers:this._headers,global:this._config.global};return r&&(i.traditional=r),this.ajax(i)},ACSRestResource.prototype.get=function(t,e){if(e=e||{},e.url?e.url=this._validateURI(e.url):$.extend(e,{url:this._getURI(t)}),!e.url&&!e.skipCache){var r=this.findAll(t);if(r&&r.length>0)return r}var i=this;return this._get(e.url,t,e.legacyJQuerySerialization).then(function(t,e,r){var o=$.Deferred(),n=i._setAjax.call(i,t);return o.resolve(n,e,r),o})},ACSRestResource.prototype._post=function(t,e){var r={type:"POST",url:t,data:e?JSON.stringify(e):null,contentType:"application/json",headers:this._headers,global:this._config.global};return this.ajax(r)},ACSRestResource.prototype.add=function(t,e){return e=e||{},e.url?e.url=this._validateURI(e.url):$.extend(e,{url:this._getURI(t)}),this._post(e.url,t).then(this._setAjax.bind(this))},ACSRestResource.prototype._put=function(t,e){var r={type:"PUT",url:t,data:e?JSON.stringify(e):null,contentType:"application/json",headers:this._headers,global:this._config.global};return this.ajax(r)},ACSRestResource.prototype.update=function(t){var e=jQuery.extend({},t),r=e._url;if(delete e._url,r=!r&&this._config.idAttribute in e?this._getURI(e):this._validateURI(r),!r)throw new Error("Missing required object._url or "+this._config.idAttribute+" attribute.");return this._put(r,e).then(this._setAjax.bind(this))},ACSRestResource.prototype._delete=function(t,e){var r={type:"DELETE",url:t,data:e&&!$.isEmptyObject(e)?JSON.stringify(e):null,contentType:"application/json",headers:this._headers,global:this._config.global};return this.ajax(r)},ACSRestResource.prototype.remove=function(t){jQuery.extend({},t);if("object"!==$.type(t)){var e={};e[this._config.idAttribute]=t,t=e}var r=t._url;if(delete t._url,r=!r&&this._config.idAttribute in t?this._getURI(t):this._validateURI(r),!r)throw new Error("Missing required object._url or "+this._config.idAttribute+" attribute.");return this._delete(r,t).done(this._remove.bind(this,t))},ACSRestResource.prototype.setLocalStorage=function(t){return window.localStorage.setItem(this._config.localStorageKey,JSON.stringify(t))},ACSRestResource.prototype.getLocalStorage=function(){return JSON.parse(window.localStorage.getItem(this._config.localStorageKey))},Object.filter=function(t,e){var r,i={};for(r in t)t.hasOwnProperty(r)&&e(t[r],r)&&(i[r]=t[r]);return i},Object.findFirst=function(t,e){var r;for(r in t)if(e(t[r],r))return t[r];return void 0},ACSRestResource.prototype.findAll=function(t){var e,r,i,o=this._store;if(!o||!Object.keys(o).length)return[];if(void 0===t)i=$.map(o,function(t){return t});else{if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid query for findAll.");i=[],$.each(o,function(e,r){var o=this._findWhere([r],t);o&&i.push(o)}.bind(this))}return e=this._config.orderBy,e&&(r=e.match(/^-([\w-]{0,})$/),null!==r&&(e=e.replace("-","")),i.sort(function(t,r){return"undefined"==typeof t[e]||null===typeof t[e]?1:"undefined"==typeof r[e]||null===typeof r[e]?-1:t[e].toString().localeCompare(r[e].toString())}),null!==r&&(i=i.reverse())),i},ACSRestResource.prototype.find=function(t){var e=this._store;return e&&Object.keys(e).length?void 0===t?void 0:"[object Object]"===Object.prototype.toString.call(t)?this._findWhere(e,t):e[t]:void 0},ACSRestResource.prototype._findWhere=function(t,e){return Object.findFirst(t,this._matcher(e).bind(this))},ACSRestResource.prototype._isMatch=function(t,e){var r=Object.keys(e),i=r.length;if(null==t)return!i;for(var o=Object(t),n=0;i>n;n++){var s=r[n];if(e[s]!==o[s]||!(s in o))return!1}return!0},ACSRestResource.prototype._matcher=function(t){return t="object"!==$.type(t)?{}:t,t=Object.filter(t,function(e,r){return t.hasOwnProperty(r)}),function(e){return this._isMatch(e,t)}},"object"==typeof module&&module.exports?module.exports=ACSRestResource:"function"==typeof define&&define.amd?define(function(){return ACSRestResource}):window.ACSRestResource=ACSRestResource;