define(["jquery","knockout","datatables","datatables-knockout","acs-components"],function(e,t,a,r,s){function n(a){var r=this;r.name=t.observable(""),r.country=t.observable(""),r.gcsParty=t.observable(""),r.geo=t.observable(""),r.queryArg=t.observableArray(),r.activeCustomerOnly=!!a.activeCustomerOnly,r.queryArg.push({label:"Name",name:"name",value:r.name}),r.queryArg.push({label:"Country",name:"country",value:r.country}),r.queryArg.push({label:"GEO",name:"geo",value:r.geo}),r.queryArg.push({label:"GCS Party",name:"gcsParty",value:r.gcsParty}),r.status=t.observable("-Status-"),r._constructQuery=function(e){var t={},a=r.queryArg(),s=[];for(var n in a){var o=a[n],u=o.name,l=o.value();l&&s.push({property:u,value:l})}(r.activeCustomerOnly||"-Status-"!=r.status())&&s.push({property:"status",value:r.activeCustomerOnly?"active":r.status()}),t.filters=s;var c=[];if(e.order.length>0){var i=e.order[0];c.push({property:e.columns[i.column].data,desc:"desc"==i.dir?!1:!0})}return t.sorts=c,t.page=(e.start/e.length).toString(),t.maxResults=e.length.toString(),JSON.stringify(t)},r._ajaxProxy=function(t){return t=e.extend({url:"",data:null,method:"PUT"},t),function(a,s){if(r.showResults){var n=r._constructQuery(a);console.log("requestData="+n),e.ajax({type:t.method,url:t.url,dataType:"json",contentType:"application/json; charset=utf-8",data:n,success:function(e,t,n){e=JSON.parse(JSON.stringify(e,function(e,t){return"null"===t||null===t?"":t}));var o={};o.data=e.result,o.draw=a.draw,o.recordsTotal=e.totalCount,o.recordsFiltered=o.recordsTotal,r.currentPageData=o.data,s(o)}})}else{var o={};o.data=[],o.draw=a.draw,o.recordsTotal=0,o.recordsFiltered=0,r.currentPageData=[],s(o)}}},r.showResults=!0,r.datatableObj=t.observable(),r.datatableOptions={serverSide:!0,ajax:r._ajaxProxy.apply(r,[{url:"rest/components/customer-picker/advanced-search",type:"PUT"}]),language:{processing:"Processing..."},stateSave:!1,orderMulti:!1,orderClasses:!1,aaSorting:[],searching:!1,columnDefs:[{targets:[0],width:r.activeCustomerOnly?"12%":"10%"},{targets:[1],width:r.activeCustomerOnly?"45%":"40%"},{targets:[2],width:"15%"},{targets:[3],width:"15%"},{targets:[4],width:r.activeCustomerOnly?"12%":"10%"},{targets:[5],visible:!r.activeCustomerOnly,width:"1%"}]},r.search=function(e,t){return(13===t.keyCode||"click"===t.type)&&(r.showResults=!0,r.datatableObj().draw()),!0},r.datatableObj.isActive=function(e){return"active"==e},r.clear=function(){r.showResults=!1,r.clearSearchTerms(),r.datatableObj().draw()},r.clearSearchTerms=function(){var e=r.queryArg();for(var t in e){var a=e[t];a.value("")}console.log("self.status clear"),r.status("-Status-")},r.selectCustomer=function(e){delete e.$data,r.modal.close(e)},r.cancel=function(){r.modal.close()}}function o(){this.createVm=function(e){var t=new n(e);return t}}return new o});