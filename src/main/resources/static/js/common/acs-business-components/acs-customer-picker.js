define(["module","knockout","jquery","suggest","acs-cache","modal-utils","./acs-customer-picker-advanced-search-modal"],function(e,t,i,n,c,s,a){function r(){var e=this;e.selection=t.observable(),e.init=function(t,n){e.cfg=t,e.element=n,e.cache=!!e.cfg.cache,e.activeCustomerOnly=!!e.cfg.activeCustomerOnly;var c=i.Deferred(),s=i.Deferred();e._registerInitCompletedProcessor(c,s),e._loadInitialSelection(),e._rendermagicSuggest(c,s)},e._registerInitCompletedProcessor=function(t,n){i.when(t,n).done(function(t,n){var c=t[0],s=t[1];e.magicSuggest=n,e._updateSelection(c,s),i(e.magicSuggest).on("selectionchange",function(t,i,n){e._updateSelection(n[0],!1)})}).fail(function(e,t){throw new Error("init acs-customer-picker failed, details: "+e+" "+t)})},e._rendermagicSuggest=function(t,n){e.inputElement=e.element.find("#ms1"),e.btnElement=e.element.find("#btn1");var s={afterLoad:function(n){var c=e.selection();if(c&&!i.isEmptyObject(c)){var s=i.grep(n,function(e){return e.customerId==c.customerId});t.resolve(0===s.length?[n[0],!0]:[s[0],!0])}else t.resolve([n[0],!0])},data:"rest/components/customer-picker/basic-search",queryParam:"keyword",displayField:"name",maxDropHeight:340,method:"GET",mode:"remote",placehodler:"Enter recipients....",updateCache:function(t,i){e.cache&&c.setItem(r._prefixCacheKey(t),i)},singleSelection:!0,valueField:"customerId",typeDelay:10,renderer:function(t){t=JSON.parse(JSON.stringify(t,function(e,t){return"null"===t||null===t?"":t}));var i="Active"===t.status?"user-active tipster":"user-disabled tipster",n="Active"===t.status?"Active":"Disabled";return statusColDiv=e.activeCustomerOnly?"none":"block",'<div class="grid"><div class="row" style="padding:2px 0 0 0; margin: 0"><div class="col-md-2" style="padding: 0; margin: 0;display:'+statusColDiv+'"><div class="user-status" style="margin: auto"><span style="vertical-align: middle" class="'+i+'" title="'+n+'"></span><em class="hidden">'+n+'</em></div></div><div class="col-md-6" style="padding: 0  ; margin: 0"><div style="color: #333; font-size: 15px; vertical-align: middle; max-width:300px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" title="'+t.name+'">'+t.name+'</div></div><div class="col-md-2" style="padding:  0  ; margin: 0"><div style="color: #333; font-size: 15px; vertical-align: middle">'+t.country+'</div></div><div class="col-md-2" style="padding:   0  ; margin: 0"><div style="color: #999; font-size: 13px"; vertical-align: middle>'+t.gcsParty+'</div></div></div></div><hr style="padding: 0; margin: 0;">'},statistic:function(e,t){return t+" of "+e},dataUrlParams:{activeCustomerOnly:e.activeCustomerOnly}};e.cache&&(s.localQuery=function(e){return c.getItem(r._prefixCacheKey(e))}),e.inputElement.magicSuggest(s),n.resolve(e.inputElement.data("magicSuggest"))},e._loadInitialSelection=function(){var n=e.cfg.selection;if(!n||!t.isObservable(n))throw new Error('An "selection" argument is required and it should be observable type.');e.selection=n,i.isEmptyObject(n())&&e.cache&&!i.isEmptyObject(c.getItem("selection"))&&e.selection(c.getItem("selection"),!0)},e._updateSelection=function(t,i){e.selection(t),e.cache&&c.setItem("selection",e.selection()),i&&e.magicSuggest.setSelection([t])},e.openAdvancedSearchModal=function(){s.showModal({viewModel:a.createVm(e.cfg),template:o+"/acs-customer-picker-advanced-search-modal",contexts:e}).then(e._updateSelection)}}function l(e,t){var n=require.s.contexts._.defined["acs-customer-picker"];n||(n=new r,require.s.contexts._.defined["acs-customer-picker"]=n);var c=i.extend(!0,{},d,e);return n.init(c,i(t.element)),n}var o=e.uri.substring(0,e.uri.lastIndexOf("/"));r._prefixCacheKey=function(e){return"CS_"+e};var d={cache:!0};t.components.register("acs-customer-picker",{viewModel:{createViewModel:l},template:{require:"text!"+o+"/acs-customer-picker.tmpl.html"}})});