define(["jquery","knockout","signal-emitter"],function(n,e,a){var t=function(t,s){var l=e.dataFor(s.element),r=s.element.id?s.element.id:n(s.element).attr("id"),i=[],o=e.observable(1),c=e.observableArray(t.selected_instance_idx||[0]),d=t.instance_list||e.unwrap(l.$report.instance_list),p=t.instance_id_property||"id",u=t.instance_label_property||"name";n.each(d,function(n,a){var t=e.unwrap(a[p]),s=e.unwrap(a[u]);i.push({index:n,id:t,name:s})});var f=function(n){n?o(n):(n=o(),n=1==n?2:2==n?4:1,o(n)),a.dispatch("Report-Chart-Size-Changed",[n])};c.subscribe(function(n){n.length>0&&(n=n.sort()),a.dispatch("Report-Instance-Selection-Changed",[n])});var v=function(){if(c().length==i.length)c([]);else{var e=[];n.each(i,function(n,a){e.push(a.index)}),c(e)}return!0},b=function(){a.dispatch("Report-Freeze-Display-Control",[])},g=function(){n("#"+r+" .dropdown-menu").on("click",function(n){n.stopPropagation()})};return{id:r,availableInstances:i,selectedInstanceIdx:c,toggleSelectAllInstances:v,toggleChartSize:f,afterRender:g,numOfColumn:o,text:"Display Setting",freezeDisplayControl:b}};return{viewModel:{createViewModel:t},template:'<div class="dropdown instance-dropdown button-group">\r\n                            <button type="button" class="btn btn-default dropdown-toggle" style="margin-bottom:0" data-toggle="dropdown"><span class="fa fa-gear pull-left"></span><span data-bind="text: text"></span><span class="fa-caret-down fa pull-right"></span></button>\r\n                            <div class="dropdown-menu dropdown-larger pull-right">\r\n                                <div class="row row-eq-height">\r\n                                    <div class="col-md-6 col-sm-6 col-xs-12 no-padding-top">\r\n                                            <h5>Instances:</h5>\r\n                                            <ui>\r\n                                                <li><input type="checkbox" data-bind="checked: selectedInstanceIdx().length == availableInstances.length, click: toggleSelectAllInstances"/>&nbsp;<label class="label-dark">All Instances</label></li>\r\n                                                <!-- ko foreach: availableInstances -->\r\n                                                <li><input type="checkbox" data-bind="checkedValue: index, checked: $parent.selectedInstanceIdx"/>&nbsp;<label class="label-dark" data-bind="text: name"></label></li>\r\n                                                <!-- /ko -->\r\n                                            </ui>\r\n                                            <div class="margin-top-15">\r\n                                               <a href="javascript:void(0);" data-bind="click: freezeDisplayControl"><span class="fa-lock fa left"></span>Freeze Current Settings</a>\r\n                                            </div>\r\n                                    </div>\r\n                                    <div class="col-md-6 col-sm-6 col-xs-12 no-padding-top separator-left">\r\n                                            <h5>Display:</h5>\r\n                                            <div class="view-mode">\r\n                                                <a href="javascript:void(0)" class="builder_tooltips" title="One Per Row" data-bind="css: numOfColumn() == 1 ? \'active\' : \'\', click: function() {toggleChartSize(1)}">\r\n                                                    <span class="view-one"></span>\r\n                                                </a>\r\n                                                <a href="#" class="builder_tooltips" title="Two Per Row" data-bind="css: numOfColumn() == 2 ? \'active\' : \'\', click: function() {toggleChartSize(2)}">\r\n                                                    <span class="view-two"></span>\r\n                                                    <span class="view-two"></span>\r\n                                                </a>\r\n                                                <a href="#" class="builder_tooltips" title="Four Per Row" data-bind="css: numOfColumn() == 4 ? \'active\' : \'\', click: function() {toggleChartSize(4)}">\r\n                                                    <span class="view-four"></span>\r\n                                                    <span class="view-four"></span>\r\n                                                    <span class="view-four"></span>\r\n                                                    <span class="view-four"></span>\r\n                                                </a>\r\n                                            </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                       </div>\r\n                       <span data-bind="template: { afterRender: afterRender }"></span>'}});