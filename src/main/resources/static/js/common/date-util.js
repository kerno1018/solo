define(["jquery","knockout","moment-timezone","user","date-picker"],function(e,t,a,n){var r=function(){var r=this;r.formatDate=function(e){return e?e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear():""},r.convertJavaDateFormat=function(e){for(var t,a={d:"D",y:"Y"},n=0;n<e.length;n++)t=e.charAt(n),e=e.replace(t,a[t]?a[t]:t);return e},r.parseDate=function(e){return a.isMoment(e)?e:"string"==typeof e?a(e,"YYYY-MM-DDTHH:mm:ss.SSS+Z"):"number"==typeof e?a(e):e instanceof Date?a(e):(console.log("will not parse date, returning null. passed object:",e),null)},r.getUserDateFormat=function(){return n.dateFormat()&&"DateFormat-TBD"!==n.dateFormat().replace(/\s/g,"")?r.convertJavaDateFormat(n.dateFormat()):"MM-DD-YYYY"},r.getUserTimeFormat=function(){return n.timeFormat()&&"TimeFormat-TBD"!==n.timeFormat().replace(/\s/g,"")?n.timeFormat():"HH:mm:ss"},r.getUserTimeZone=function(){return n.timeZone()};var i=function(t,a,r){e(t).datetimepicker(r).on("dp.change",function(e){var t=a();t(n.timeZone()&&e.date&&void 0===e.date.tz()&&e.oldDate?e.oldDate:e.date)})},o=function(r,i,o){var s=t.utils.unwrapObservable(i()),m=o().timeZone||n.timeZone();"number"==typeof s&&(s=a(s),m&&void 0===s.tz()&&(s=s.tz(m))),a.isMoment(s)&&m&&void 0===s.tz()&&(s=s.tz(m)),"boolean"==typeof s&&(s=null),e(r).data("DateTimePicker").date(s)};t.bindingHandlers.datePicker||(t.bindingHandlers.datePicker={init:function(e,t,a){var n=a().dateOptions||{};n.format=r.getUserDateFormat(),i(e,t,n)},update:o}),t.bindingHandlers.timePicker||(t.bindingHandlers.timePicker={init:function(e,t,a){var n=a().dateOptions||{};n.format=n.useSeconds?"HH:mm:ss":"HH:mm",i(e,t,n)},update:o}),t.bindingHandlers.dateTimePicker||(t.bindingHandlers.dateTimePicker={init:function(e,t,a){var n=a().dateOptions||{};if(n.format)n.format=r.convertJavaDateFormat(n.format);else{var o=n.useSeconds?"HH:mm:ss":"HH:mm";n.format=r.getUserDateFormat()+" "+o}i(e,t,n)},update:o}),t.bindingHandlers.dateValue||(t.bindingHandlers.dateValue={init:function(a,n,i,o){var s=r.parseDate(t.utils.unwrapObservable(n()));a.setAttribute("value",s.format()),e(a).change(function(){var e=n();e(a.getAttribute("value"))})},update:function(e,a,n,r){var i=t.utils.unwrapObservable(a()),o=t.selectExtensions.readValue(e);i!==o&&t.selectExtensions.writeValue(e,i)}}),t.bindingHandlers.dateText||(t.bindingHandlers.dateText={update:function(a,n,i,o){var s="",m=r.parseDate(t.utils.unwrapObservable(n()));if(m)switch(i.get("include")){case"time":s=m.format(r.getUserTimeFormat());break;case"both":s=m.format(r.getUserDateFormat()+" "+r.getUserTimeFormat());break;default:s=m.format(r.getUserDateFormat())}e(a).text(s)}});var s=function(e,t){this.text=e,this.code=t},m=new a;r.availableDateFormats=t.observableArray(),e.each(["MM-DD-YYYY","MM.DD.YYYY","MM/DD/YYYY","DD-MM-YYYY","DD.MM.YYYY","DD/MM/YYYY","YYYY-MM-DD","YYYY.MM.DD","YYYY/MM/DD","MMMM Do, YYYY","Do. MMMM YYYY"],function(e,t){r.availableDateFormats.push(new s(m.format(t),t))}),r.availableTimeFormats=t.observableArray(),e.each(["HH:mm:ss","HH:mm:ss Z","hh:mm:ss a","hh:mm:ss a Z"],function(e,t){r.availableTimeFormats.push(new s(m.format(t),t))}),r.availableTimeZones=t.observableArray(),e.each(a.tz._zones,function(e,t){r.availableTimeZones.push(t.displayName)})};return new r});