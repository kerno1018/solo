define(["jquery","knockout","signal-emitter"],function(t,e,n){var i=function(i,a){var s,d="undefined"==typeof i.customizationEnabled?!1:i.customizationEnabled,l="undefined"==typeof i.readOnly?!1:i.readOnly,o=e.observable(!1),r=e.unwrap(i.placeholder),b=i.mode,c=i.value?e.isObservable(i.value)?i.value:e.observable(i.value):e.observable(),h=e.observable(),v=e.observable(),p=i.header_tag?i.header_tag:"h2",m=e.isObservable(i.visible)?i.visible:e.observable("undefined"==typeof i.visible?!0:i.visible),u=e.unwrap(i.broadcast_change);if(!h()){var f="";t.each(a.templateNodes,function(t){this instanceof HTMLElement?f+=this.outerHTML:this instanceof Text&&(f+=this.textContent)}),(f=f.trim()&&f)?(s=f,h(s)):h(c())}c.subscribe(function(t){s||h(t)});var g=function(){var t=h();"title"==b&&t&&!t.startsWith("<"+p+">")&&(t="<"+p+">"+t+"</"+p+">"),v(t),o(!0)},C=function(){var t=v();"title"==b&&(t=t.trim())&&(t.startsWith("<"+p+">")&&(t=t.substring(4)),t.endsWith("</"+p+">")&&(t=t.substring(0,t.length-5))),!t||t.startsWith("<")&&t.endsWith(">")||(t="<span>"+t+"</span>"),u&&n.dispatch("Report-Component-Content-Changed",[a.element,t]),h(t),c(t),o(!1)},y=function(){o(!1)},E=function(){n.dispatch("Report-Component-Param-Changed",[a.element,"readOnly",!0])};return n.addListener("Report-Template-Attr-Changed:"+a.element.id,function(t,e,n){"visible"===e&&m(n)},this),{visible:m,showCustomization:e.isObservable(d)?d:e.observable(d),inEditMode:o,beginEdit:g,finishEdit:C,cancelEdit:y,htmlContent:h,inputBuffer:v,readOnly:l,mode:b,placeholder:r,icon:i.icon,headerTag:p,freeze:E}};return{viewModel:{createViewModel:i},template:'<div data-bind="visible: visible() || showCustomization(), css: (!visible() & showCustomization()) ? \'opaque\': \'\'">\r\n                                <div data-bind="if: showCustomization, visible: !readOnly">\r\n                                    <div data-bind="if: inEditMode">\r\n                                        <acs-text-editor params="value: inputBuffer, mode: mode"></acs-text-editor>\r\n                                            <div class="button-con margin-top-15"><div class="float-right">\r\n                                                <button class="btn btn-primary" value="Update" data-bind="click: finishEdit"><span class="fa-check fa left"></span>Update</button>\r\n                                                <button class="btn btn-default" value="Cancel" data-bind="click: cancelEdit"><span class="fa-remove fa left"></span>Cancel</button>\r\n                                            </div></div>\r\n                                        <div style="clear: both"></div>\r\n                                    </div>\r\n                                    <div data-bind="ifnot: inEditMode">\r\n                                        <table>\r\n                                            <tr>\r\n                                                <td>\r\n                                                    <div data-bind="visible: mode != \'title\', html: htmlContent() ? htmlContent() : placeholder"></div>\r\n                                                    <h2 data-bind="visible: mode == \'title\' && headerTag == \'h2\'" class="section-title no-border"><span class="fa bg-blue-light icon" data-bind="visible: icon, css: icon"></span><span data-bind="html: htmlContent() ? htmlContent() : placeholder"></span></h2>\r\n                                                    <h3 data-bind="visible: mode == \'title\' && headerTag == \'h3\'" class="section-title no-border"><span class="fa bg-blue-light icon" data-bind="visible: icon, css: icon"></span><span data-bind="html: htmlContent() ? htmlContent() : placeholder"></span></h3>\r\n                                                </td>\r\n                                                <td data-bind="css: mode != \'title\' ? \'vertical-top\' : \'vertical-middle\'">\r\n                                                    <span class="field-action"><a href="javascript:void(0)" data-bind="click: beginEdit"><i class="fa-pencil fa"></i> Edit</a></span>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </table>\r\n                                    </div>\r\n                                </div>\r\n                                <div data-bind="visible: mode != \'title\' && (!showCustomization() || readOnly), html: htmlContent"></div>\r\n                                <h2 data-bind="visible: mode == \'title\' && headerTag == \'h2\' && (!showCustomization() || readOnly)" class="section-title no-border"><span class="fa bg-blue-light icon" data-bind="visible: icon, css: icon"></span><span data-bind="html: htmlContent"></span></h2>\r\n                                <h3 data-bind="visible: mode == \'title\' && headerTag == \'h3\' && (!showCustomization() || readOnly)" class="section-title no-border"><span class="fa bg-blue-light icon" data-bind="visible: icon, css: icon"></span><span data-bind="html: htmlContent"></span></h3>\r\n                                \r\n                       </div>'}});