define(["jquery","knockout"],function(e,n){var r,s=this;s.hideInAction=null,s.showAlerts=function(e,n,r,i){s.hideInAction?s.hideInAction.done(function(){t(e,n,r,i)}):t(e,n,r,i)};var t=function(n,t,i,l){var o,a,c,d;if(!t||!n)return!1;if("warning"==n?(o="alert-warning",d="Warning"):"success"==n?(o="alert-success",d="Success"):"error"==n?(o="alert-danger",d="Error"):"info"==n&&(o="alert-info",d="Information"),i=(i=i||e("#main"))instanceof jQuery?i:e(i),e("#scroller").length>0){if(s.scroller=e("#scroller"),s.scroller.children().length>0){var h=e(s.scroller.children()[0]).find(".alertMessage"),f=l?h.html():h.text();if(f===t)return!1}}else s.scroller=e(i.is("#mainContent")||i.is("#main")?"<div id='scroller'></div>":"<div id='simple-alert-wrapper'></div>"),i.prepend(s.scroller);a=e('<div class="alert alert-dismissable" role="alert" '+(i.is("#mainContent")||i.is("#main")?'style="margin-top: -30px;z-index: -1">':'style="display:none">')+'<div class="alertType alert-icon"></div>'+(i.is("#mainContent")||i.is("#main")?'<button type="button" class="alert-close-button close" aria-label="Close"></button>':"")+"</div>"),a.addClass(o);var u=e('<b class="alertTitle">'+d+":&nbsp;</b>"),p=e('<p class="alertMessage" style="word-wrap: break-word;"></p>');if(l?p.html(t):p.text(t.truncText()),p.prepend(u).insertAfter(a.find(".alertType")),s.scroller.prepend(a),i.is("#mainContent")||i.is("#main")?a.animate({marginTop:["0px","swing"]},350,function(){e(this).css("z-index",s.scroller.children().length+1),e(this).css("margin-top",""),a.attr("show-time",(new Date).getTime())}):a.slideDown({easing:"swing"},250),s.scroller.children().length>=2&&(c=e(s.scroller.children()[1]),c.hasClass("alert-success")||c.hasClass("alert-info"))){var m=(new Date).getTime()-parseInt(c.attr("show-time"));setTimeout(function(){c.slideUp(function(){e(this).remove()})},15e3-m)}(i.is("#mainContent")||i.is("#main"))&&(a.find(".alert-close-button").on("click",function(){r=null,a.remove(),0==s.scroller.children().length&&s.scroller.remove()}),s.pinAlert())};return s.pinAlert=function(){var n=function(){var n=e("#scroller");if(n.length>0){var r=e(window).scrollTop(),s=e("#scroller-anchor").offset().top;r>s?n.addClass("clipped"):s>=r&&n.removeClass("clipped")}};e(window).scroll(n),n()},s.showSuccessAlert=function(e,n,t,i){r!==e&&(s.showAlerts("success",e,n,t,i),r=e)},s.showErrorAlert=function(e,n,t){if(r!==e){if("object"==typeof e&&e.message){if("object"==typeof r&&r.message===e.message&&r.rootCause===e.rootCause)return;var i=(e.errorCode?"("+e.errorCode+") ":"")+e.message+(e.logRefCode?" ["+e.logRefCode+"]":"")+(e.rootCause?" - "+e.rootCause:"");s.showAlerts("error",i,n,t)}else s.showAlerts("error",e,n,t);r=e}},s.showWarningAlert=function(e,n,t){r!==e&&(s.showAlerts("warning",e,n,t),r=e)},s.showInfoAlert=function(e,n,t,i){r!==e&&(s.showAlerts("info",e,n,t,i),r=e)},s.hideAlert=function(){var n=e("#mainContent").find("#scroller");0===n.length&&(n=e("#main").find("#scroller")),n.length>0&&(s.hideInAction=e.Deferred(),n.slideUp("slow","swing",function(){r=null,e(this).remove(),s.hideInAction.resolve()}));var t=e("#simple-alert-wrapper");t.length>0&&(s.hideInAction&&"pending"===s.hideInAction.state||(s.hideInAction=e.Deferred()),t.slideUp("slow","swing",function(){r=null,e(this).remove(),s.hideInAction&&s.hideInAction.resolve()}))},s.showDelayedAlert=function(e,n,t,i,l){r!==n&&(s.showAlerts(e,n,t,i),r=n)},s});